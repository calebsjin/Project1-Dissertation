var CwZ,referenceCollector=function(){var c={};return{addReferences:function(a){a&&a.forEach(function(a){if(a.year){var d="",k=[];c.hasOwnProperty(a.year)||(c[a.year]={});for(var e=a.author.split(/ and |,|\s/),f=0;f<e.length;f++)0===f%2&&e[f].trim()&&k.push(e[f].trim().replace(/\[|\]/g,"")),e[f].charAt(0)===e[f].charAt(0).toUpperCase()&&(d+=e[f].charAt(0));k.push(d);c[a.year][a.id]=k}})},getReference:function(a,b){var d=a,k=-1;if(c.hasOwnProperty(b))if(1<Object.keys(c[b]).length){var k={},d=d.replace(" et al.",
"").replace(/[&|;|(|)|,|"]/g,""),d=d.replace(" and "," ").replace("  "," "),d=d.replace(/([a-z])([A-Z])/g,"$1 $2"),d=d.split(" "),e;for(e in c[b]){var f;f=c[b][e];var l=0,g=d.length;if(0<g){for(var h=0;h<f.length;h++)for(var m=0;m<g;m++)d[m]===f[h]&&l++;f=Math.floor(l/g*100)}else f=0;k[f]=e}k=k[Object.keys(k)[Object.keys(k).length-1]]}else k=parseInt(Object.keys(c[b])[0],10);return k},getTestReference:function(){return c}}}(),CWPDFReaderDialogClass=function(){function c(){this.msgBox=this.dialog=
null;this.dontHide=!1;this.params=""}c.prototype.init=function(){var a=this;this.dialog=CwZ("#cw-dialogBox");this.msgBox=CwZ("#cw-dialogBox span");CwZ("#firstButton").on("click",function(){a.onOkFunc();a.dontHide||a.hide()});CwZ("#secondButton").on("click",function(){a.onCancelFunc();a.hide()})};c.prototype.onOkFunc=function(){};c.prototype.onCancelFunc=function(){};c.prototype.show=function(a){this.dialog||this.init();this.reset();this.params=a;var b={ok:a.okBtnTxt,cancel:a.cnclBtnTxt};this.setMessage(a);
this.setOkFunction(a.onOk,a.dontHide);this.setCancelFunction(a.onCancel);this.setButtons(b);this.setHeader(a.title);this.dialog.show()};c.prototype.setCancelFunction=function(a){void 0!==a?(this.onCancelFunc=a,this.dialog.find("#secondButton").show()):(this.params.cnclBtnTxt||this.dialog.find("#secondButton").hide(),this.onCancelFunc=function(){this.dialog.hide()})};c.prototype.setOkFunction=function(a,b){void 0!==a?(this.onOkFunc=a,this.dontHide=void 0!==b&&b?!0:!1):this.onOkFunc=function(){this.hide()}};
c.prototype.setMessage=function(a){var b=a.msg;void 0===b?(b="",this.msgBox.hide()):("string"!==typeof b&&(b=b.toString()),this.msgBox.show());"html"!==a.msgType?this.msgBox.text(b):this.msgBox.html(b)};c.prototype.setButtons=function(a){var b=this.dialog.find("#firstButton"),d=this.dialog.find("#secondButton");void 0!==a.ok&&""!==a.ok?b.text(a.ok):b.text("Ok");void 0!==a.cancel&&""!==a.cancel?d.text(a.cancel):d.text("Cancel")};c.prototype.setHeader=function(a){var b=this.dialog.find(".cw-dialog-heading");
a?b.text(a):b.text("")};c.prototype.hide=function(){this.dialog.hide()};c.prototype.reset=function(){this.onOkFunc=function(){};this.onCancelFunc=function(){};this.msgBox.text("");this.dialog.find("#firstButton").text("");this.dialog.find("#secondButton").text("");this.dialog.find(".cw-dialog-heading").text("");this.params=""};return c}(),CWPDFReaderDialog=new CWPDFReaderDialogClass,CWCitationMaker_class=function(){function c(){this.defaultStyleCitation="";this.defaultCit=!1}c.prototype.appendCitationHTML=
function(a){CwZ(".bib-body").find("b").is(":visible")?CwZ(".bib-body").removeClass("bib-loading"):(this.defaultCit||(this.defaultStyleCitation=CwZ(a).text().trim(),this.defaultCit=!0),CwZ(".bib-body").removeClass("bib-loading"),CwZ(".bib-body .csl-bib-body").remove(),CwZ("#format-citation .bib-body").text(""),CwZ("#format-citation .bib-body").append(a),a?CwZ("#copyToClipboard").removeClass("disabled"):0===CwZ("#format-citation .bib-body").find(".info-base-text").length&&CwZ("#format-citation .bib-body").append('<b class="info-base-text" style="">Citation style not supported</b>'))};
c.prototype.bindCitControlEvents=function(a){var b=this;CwZ("#removeText").off("click").on("click",function(){CwZ("#formatStyles").val("");CwZ("#formatStyles").trigger("focus");CwZ(".bib-body .csl-bib-body").remove();CwZ("#copyToClipboard").addClass("disabled");CwZ(".bib-body").find("b").show();0===CwZ("#format-citation .bib-body").find(".info-base-text").length?CwZ("#format-citation .bib-body").append('<b class="info-base-text" style="">Type your citation styles for preview</b>'):CwZ("#format-citation .bib-body").find("b").text("Type your citation styles for preview")});
CwZ(".citeStyles li").off("click").on("click",function(){CwZ("#formatStyles").val("");CwZ(".citeStyles li").removeClass("selected");CwZ(this).addClass("selected");var a=CWPDFReader.jsonHash[CwZ(this).find(".styleItem").attr("data-val")];a?(CwZ(".bib-body").find("b").hide(),CwZ("#formatOptions").addClass("hidden"),-1!==a.indexOf(":")&&(a=a.split(":")[1]),CwZ(".bib-body .csl-bib-body").remove(),CwZ(".bib-body").addClass("bib-loading"),CWPDFReader.CWIFrameManager.tell("executeFormattedCitation",{view:"mainExt",
style:a,source:"pdfFrame"})):"more"===CwZ(this).find(".styleItem").attr("data-val")&&(CwZ("#copyToClipboard").addClass("disabled"),CwZ("#formatStyles").trigger("focus"),CwZ(".bib-body .csl-bib-body").remove(),0===CwZ("#format-citation .bib-body").find(".info-base-text").length&&CwZ("#format-citation .bib-body").append('<b class="info-base-text" style="">Type your citation styles for preview</b>'),CwZ("#formatOptions").removeClass("hidden"))});CwZ.fn.selectText=function(){var a=this[0];if(document.body.createTextRange){var b=
document.body.createTextRange();b.moveToElementText(a);b.select()}else if(window.getSelection){var d=window.getSelection(),b=document.createRange();b.selectNodeContents(a);d.removeAllRanges();d.addRange(b)}};try{/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||CwZ(".bib-body").removeAttr("contenteditable")}catch(d){CWUtils.log(d)}CwZ("#copyToClipboard").on("click",function(){if(!CwZ(this).hasClass("disabled"))if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))CwZ(".csl-entry").on("focus",
function(a){CwZ("#copyToClipboard").attr("data-tooltip","Press Command+C to copy");CwZ(this).selectText()}),CwZ(".csl-entry").attr("tabindex",-1).trigger("focus");else{CwZ(this).attr("data-tooltip","Copied!");var a=CwZ(".csl-bib-body")[0];CWUtils.copyToClipboard(a)}});CwZ("#copyToClipboard, .share-link").on("mouseleave",function(a){CwZ("#copyToClipboard").removeAttr("data-tooltip");CwZ(".share-link").find("span").removeAttr("data-tooltip")});CwZ(".share-link").find("span").on("click",function(a){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?
(CwZ(".share-link").on("focus",function(){CwZ(".share-link").find("span").attr("data-tooltip","Press Command+C to copy");CwZ(this).selectText()}),CwZ(".share-link").trigger("focus")):(CwZ(this).attr("data-tooltip","Copied!"),a=CwZ(".share-link").find("input")[0],CWUtils.copyToClipboard(a),CwZ(".csl-entry").trigger("focus"))});CwZ(".social-links").find("a.smLink").on("click",function(a){var e=CwZ(this).attr("data-attr");a="";var d="Just made my Research life a breeze using wizdom.ai. Join me and see what you've been missing - ",
c="Join wizdom.ai and get your research life organized",g=window.parent.location.toString(),h=Base64.decode(CWPDFReader.pubOpened.title);switch(e){case "share-facebook":a="//www.facebook.com/sharer.php?u=[URL]";break;case "share-gplus":a="https://plus.google.com/share?url=[URL]";break;case "share-linkedin":c="Interesting article";d=b.defaultStyleCitation;d=encodeURIComponent(d);a="//www.linkedin.com/shareArticle?mini=true&url=[URL]&title=[TITLE]&summary=[MESSAGE]&source=Colwiz";break;case "share-twitter":90<
h.length&&(h=h.substr(0,90)+"...");a="//twitter.com/intent/tweet?text=[MESSAGE]";d="Interesting article - "+h+" - "+encodeURIComponent(g);break;case "share-email":c=encodeURIComponent("Interesting paper - "+h),d="You might be interested in reading this paper.\n\n"+("Title: "+h+"\n"),CWPDFReader.pubOpened.authors&&(d+="Authors: "+CWPDFReader.pubOpened.authors+"\n"),CWPDFReader.pubOpened["abstract"]&&(d+="Abstract: "+CWPDFReader.pubOpened["abstract"]+"\n"),d=encodeURIComponent(d),a="mailto:?subject=[TITLE]&body=[MESSAGE][URL]"}e=
window.screen.width/2-310;h=window.screen.height/2-250;a=a.replace("[URL]",encodeURIComponent(g)).replace("[MESSAGE]",d).replace("[TITLE]",c);a=window.open(a,"shareSocial","height=400,width=600left="+e+",top="+h+",screenX="+e+",screenY="+h);window.focus&&a.focus()});CwZ(".share-link").find("input").val(window.parent.location.toString());CWPDFReader.cslJson=a;CWPDFReader.cslJson=JSON.parse(CWPDFReader.cslJson);CWPDFReader.jsonNames=[];CWPDFReader.jsonHash=[];CwZ.each(CWPDFReader.cslJson,function(a,
b){CWPDFReader.jsonNames.push(b);CWPDFReader.jsonHash[b]=a});CwZ("#formatStyles").autocomplete({minLength:2,source:CWPDFReader.jsonNames,select:function(a,b){var d=CWPDFReader.jsonHash[b.item.value];-1!==d.indexOf(":")&&(d=d.split(":")[1]);CwZ(".bib-body .csl-bib-body").remove();CwZ(".bib-body").addClass("bib-loading");CwZ(".bib-body").find("b").hide();CWPDFReader.CWIFrameManager.tell("executeFormattedCitation",{view:"mainExt",style:d,source:"pdfFrame"})},search:function(a,b){CwZ(this).data("ui-autocomplete").menu.bindings=
CwZ()}})};return c}(),CWCitationMaker=new CWCitationMaker_class,CWPDFReaderClass=function(){function c(){this.autoSyncTriggerTimer=this.syncDisplayTimer=this.CWIFrameManager=null;this.bPubInLib=this.bInitDone=!1;this.syncTip=null;this.bMouseOverATLBtn=this.bMouseOverATLTip=this.showProgTip=!1;this.myProfileLink="";this.textHighLightOn=!1;this.pubIdUrl="";this.pubOpened={};this.pdfState={zoomLevel:100,scrollPosX:0,scrollPosY:0,lastAction:"",toolSelected:"",currentPageNumber:"",lastSelectedCommentID:"",
sideBarVisible:!0};this.commentsSyncPending=!1;this.pdfStateString="";this.annotationAdded=!1;this.cslJson={};this.jsonNames=[];this.jsonHash=[];this.mouseWheelMoving=this.ctrlKey=this.zoomInProgress=!1;this.viewInLibraryWindow=null;this.HIDE_TIMEOUT=2E3;this.window_=window;this.isMouseNearZoomControl=this.isMouseNearHotspot=!1}c.prototype.bindFollowBtn=function(){var a=this;CwZ(".cw-follow").off(".cw-follow").on("click",function(){var b=CwZ(this).attr("data-id");a.followAuth(b)})};c.prototype.followAuth=
function(a){this.CWIFrameManager.tell("followAuth",{message:"followAuth",authorId:a,view:"mainExt"})};c.prototype.initialize=function(){var a=this;CWPDFReaderConfig.readerMode===CWPDFReaderMode.Publisher&&window.parent.publisher&&(publisher=window.parent.publisher);this.applyReaderOptions(publisher);CwZ(".hideElements").removeClass("hideElements");this.textSelectionTool();if(publisher.readerOptions.authorProfile)try{CWDataHolder.getAuthorsArr().then(function(b){CWDataHolder.authorApi=new CWAuthorTip(b);
var e=Object.keys(b);if(0<e.length){for(var d=0;d<e.length;d++){var c=CWHtmlStructure.getAuthorSideBarLi(b[e[d]],e.length);CwZ(".cw-authorTab .authorList").append(c)}a.bindFollowBtn()}else CwZ('.cw-sideBarNav [data-action="cw-authorTab"]').hide(),CwZ(".cw-tabNavigator .cw-authorTab").hide()}),CwZ(".cw-sideBar .cw-authorTab .icon-close").on("click",function(a){CwZ(".cw-sideBar .cw-authorTab .tips-box").fadeOut("fast")})}catch(b){CWUtils.log(b)}var d=CwZ(".cw-page-counter input").attr("placeholder");
CwZ(".cw-page-counter").off("mouseenter").on("mouseenter",function(a){CWDataHolder.isOnPageCounter=!0;CWDataHolder.pageCounterTimer&&(clearTimeout(CWDataHolder.pageCounterTimer),CwZ(".cw-page-counter").fadeIn())});CwZ(".cw-page-counter").off("mouseleave").on("mouseleave",function(a){CWDataHolder.isOnPageCounter=!1;CwZ(".cw-page-counter input").is(":focus")||(CWDataHolder.pageCounterTimer=setTimeout(function(){CwZ(".cw-page-counter input").is(":focus")||CwZ(".cw-page-counter").fadeOut()},CWDataHolder.pageCounterDelay))});
CwZ(".cw-page-counter input").on("change",function(){var a=CwZ(".cw-page-counter input").prop("value");if(-1!==a.indexOf("/"))CwZ(".cw-page-counter input").prop("value","").blur();else if(parseInt(a,10)<=CWPageManager.totalPages&&0<parseInt(a,10)){var b=CwZ("#cw-page-"+a).offset().top;window.isCwMobile.any()&&(b=CwZ("#cw-page-"+a)[0].offsetTop/mobileConfig.SCALE);CWUtils.moveScrollbarTo("body",b);CwZ(".cw-page-counter input").prop("value","").blur()}else CwZ(".cw-page-counter input").prop("value",
"").blur(),this.placeholder=d});CwZ(".cw-page-counter input").on("keyup",function(a){13===a.keyCode&&CwZ(".cw-page-counter input").blur()});CwZ(".cw-page-counter input").on("blur",function(){CWDataHolder.pageCounterTimer=setTimeout(function(){CwZ(".cw-page-counter input").is(":focus")||CwZ(".cw-page-counter").fadeOut()},CWDataHolder.pageCounterDelay)});CwZ(".cw-page-counter input").on("click",function(){d=this.placeholder;this.placeholder=""});CwZ(".cw-text-tip-edit textarea").on("blur",function(){CwZ(".cw-text-tip-edit").hide();
var a=CwZ(".cw-text-tip-edit textarea"),b=a.val().replace(/\n/g," ").trim();if(0<b.length){var d=CWCommentManager.getCommentById(CWDataHolder.currentComment.ID);d&&(CWDraw.updateShapeComment(d.ID,b),d.cmt=b,d.ts=(new Date).getTime(),CwZ("#"+d.ID).find("p").text(b),CwZ(document).trigger("cwAnnotationsUpdated"),a.val(""))}});CwZ(".cw-text-tip-edit textarea").on("keydown",function(a){13===a.keyCode&&CwZ(".cw-text-tip-edit textarea").blur()});CwZ("#cw-pdfReader").on("click",function(a){CWDataHolder.lastActivity.click=
(new Date).getTime();CWPDFTour.hideAll();try{CwZ(a.target).closest("div")&&!CwZ(a.target).closest("div")[0].classList.contains("cw-text-tip-edit")&&CwZ(".cw-text-tip-edit").hide()}catch(b){CWUtils.log(b)}});CwZ(".cw-search-dropdown").on("click",function(){CwZ(".cw-search-dropdown input").trigger("focus");CwZ(".cw-sideBarNav").stop(!0,!0).fadeIn("slow");CwZ("header").stop(!0,!0).fadeIn("slow")});CwZ('.other-notifier [data-action="install-other-extension"]').on("click",function(a){if(window.sidebar&&
window.sidebar.addPanel)window.sidebar.addPanel("wizdom.ai Importer",'javascript:(function(){let spt=document.createElement("script");spt.src="https://www.wizdom.ai/js/book.js";spt.type="text/javascript";document.getElementsByTagName("body")[0].appendChild(spt);})();',"");else if(window.sidebar&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")||window.opera&&window.print){var b=CwZ(this);b.attr("href",'javascript:(function(){let spt=document.createElement("script");spt.src="https://www.wizdom.ai/js/book.js";spt.type="text/javascript";document.getElementsByTagName("body")[0].appendChild(spt);})();');
b.attr("title","wizdom.ai Importer");b.attr("rel","sidebar");b.off(a)}else window.external&&"AddFavorite"in window.external?window.external.AddFavorite('javascript:(function(){let spt=document.createElement("script");spt.src="https://www.wizdom.ai/js/book.js";spt.type="text/javascript";document.getElementsByTagName("body")[0].appendChild(spt);})();',"wizdom.ai Importer"):CWUtils.log("browser doesn't support!");CwZ(".cw-plugin-notifier").removeClass("show");localStorage.setItem("hideExtNotifier",
"true")});publisher.readerOptions.showSuppMaterial?window.parent.CWParser.getSupplementalContent().then(function(a){var b=CwZ(".cw-download-content .module2 ul"),d=0,c={},g;for(g in a)CwZ.extend(c,a[g]);a=Object.keys(c);for(g=0;g<a.length;g++){var h=CWHtmlStructure.getSupplementLiHtml(a[g],c[a[g]]);b.append(h);d++}0<d?(CWDataHolder.hasSuppMaterial=!0,CwZ(".cw-download-content .module2").show(),CwZ(".cw-download-content .module2 h4 b").text(d),CwZ(".cw-download-tip .ipdf-bubble-notifier").text(d),
CwZ(".cw-download-tip .ipdf-bubble-notifier").show(),CwZ(".cw-download-tip .ipdf-bubble-notifier").attr("style")||CwZ(".cw-download-tip .ipdf-bubble-notifier").css("display","inline")):CwZ(".cw-download-content .module2").hide()},function(a){CWUtils.log("*** Supplementary Material Not Found ***")}):CwZ(".cw-download-content .module2").hide();window.isCwMobile.any()&&this.initMobile()};c.prototype.initMobile=function(){var a=this;CwZ("body").addClass("cw-read-only");window.isCwMobile.iOS()&&CwZ("#cw-pdfDocument").css("overflow-x",
"auto").css("-webkit-overflow-scrolling","touch");CwZ("#cw-dialogBox").remove();CwZ("#cw-loader").remove();CwZ(".loginPromt").remove();CwZ(".guideTipContainer").remove();CwZ(".cw-plugin-notifier").remove();CwZ(".cw-sideBarNav").remove();CwZ(".cw-sideBar").remove();CwZ(".cw-page-counter input").css("width","50px");CwZ(".cw-text-tip-edit").addClass("mobile");CwZ(".cw-drawing-tools > a:first").on("touchend",function(){setTimeout(function(){CwZ('.cw-btn[data-action="drawing tools"]').trigger("click")},
100)});CwZ(".cw-pageContent").css("zoom",mobileConfig.ASPECT_RATIO);if(window.isCwMobile.iOS()){var b=CwZ(".cw-text-tip-edit");b.width(document.body.clientWidth-60);b.css("left","0px");b.removeClass("mobile");b.css("position","absolute");b.css("transform-origin","top left");b.find("textarea").css("font-size","16px");CwZ(".cw-text-tip-edit textarea").on("touchend",function(e){setTimeout(function(){a.showAnnotText({});b.show()},550)});var d=CwZ('meta[name="viewport"]').attr("content"),d=d.replace("user-scalable=no",
"user-scalable=yes").replace("maximum-scale=1","maximum-scale=2");CwZ('meta[name="viewport"]').attr("content",d);CwZ(".zoomActionBtn").hide();var c=CwZ("header")[0];c.style.transformOrigin="top left";c.style.width=(document.width||document.body.clientWidth)+"px";c.style.position="absolute";var e=CwZ(".cw-page-counter");e[0].style.position="absolute";e.find("input").css("font-size","16px");e.find("input").on("focus",function(){setTimeout(function(){e.css("bottom",document.body.clientHeight-document.body.scrollTop-
54-60)},150)});var f;window.addEventListener("scroll",function(){var a=window.innerWidth/document.documentElement.clientWidth;CwZ("header")[0].style.transform="scale("+a+")";CwZ("header")[0].style.top=document.body.scrollTop+"px";CwZ("header")[0].style.left=window.pageXOffset+"px";e=CwZ(".cw-page-counter");.9>a?e.addClass("hidden"):e.removeClass("hidden");e.css("bottom",14-document.body.scrollTop);e.css("right",22-document.body.scrollLeft)});window.addEventListener("touchstart",function(){f&&clearTimeout(f)},
!0);window.addEventListener("touchmove",function(){CwZ("header").hide()},!0);window.addEventListener("touchend",function(){CwZ("header")[0].style.top=document.body.scrollTop+"px";CwZ("header")[0].style.left=window.pageXOffset+"px";f=setTimeout(function(){CwZ("header").fadeIn("fast");f=!1},400)},!0);CwZ(window).on("orientationchange",function(){c.style.width=(document.width||document.body.clientWidth)+"px";CwZ(".cw-text-tip-edit").width(document.body.clientWidth-60)})}};c.prototype.onRenderComplete=
function(){window.isCwMobile.any();CWPDFReaderConfig.readerMode!==CWPDFReaderMode.Publisher&&this.setRelatedPubs();CWPDFTour.init()};c.prototype.delaySync=function(){CWUtils.log("Delaying Sync");var a=this;this.autoSyncTriggerTimer&&(clearTimeout(this.autoSyncTriggerTimer),this.autoSyncTriggerTimer=setTimeout(function(){(function(b){return a.syncData(!0)})},4E3))};c.prototype.doDelayedSync=function(){var a=this;CWUtils.log("Triggering Delayed Sync");this.autoSyncTriggerTimer&&clearTimeout(this.autoSyncTriggerTimer);
this.autoSyncTriggerTimer=setTimeout(function(){a.syncData(!0)},4E3)};c.prototype.checkROMode=function(a,b){return null==CWCommentManager.selectedComments||CWCommentManager.selectedComments.isCurrentUser?!1:(b.stopImmediatePropagation(),CWPDFReaderDialog.show({cnclBtnTxt:"No",okBtnTxt:"Yes",dontHide:!1,title:"",msg:"You cannot change others annotations. Do you want to navigate to your annotations?",onOk:function(){CwZ(".cw-annotatorsDropDown").val(CWPDFReaderConfig.uId);CWCommentManager.setSelectedComments(CWPDFReaderConfig.uId);
a.trigger("click")},onCancel:function(){}}),!0)};c.prototype.generateReaderYearJSON=function(a){referenceCollector.addReferences(a)};c.prototype.loadReferences=function(a){if(a&&0<a.length){for(var b=CwZ("#cw-referenceTab").find("ul"),d="",c=0;c<a.length;c++){var e=a[c],f=e.title,l=e.doi,g=e.author,h=e=void 0;l?e="http://dx.doi.org/"+CwZ.trim(l):h=f?"https://scholar.google.com.pk/scholar?hl=en&q="+encodeURIComponent(CwZ.trim(f)):"";g&&((f=g.replace(/\s{2}/," ").replace(/[;|(|)|"|:|<|>|\[|\]]/g,"").replace(/\s*(\beds\b\.?|\bet al\b\.?|ed\.?)\s*/i,
"").replace(" and "," ").match(/\w+(,\s(\w{1}\.?)+)?/g))&&(f=f.join('" "')),encodeURIComponent('"'+CwZ.trim(f)+'"'));a[c].scholarURL=h;a[c].url=e;a[c].index=c;a[c].year=a[c].year&&0<a[c].year.length?a[c].year:void 0;a[c].refText&&(a[c].refText=a[c].refText.trim());d+=CWHtmlStructure.getReferenceTip(a[c])}b.append(d);CwZ(".refLinkContainer").off("click").on("click",function(){CWEventTracker.pushEvent("ViewArticle")});CwZ(".cw-reference .listLinkContainer > a").off("click").on("click",function(a){switch(this.text){case "Find Article":CWEventTracker.pushEvent("findReferencedPub");
break;case "View Article":CWEventTracker.pushEvent("viewReferencedPub")}})}else CwZ(".cw-tabNavigator li a.cw-referenceTab").remove(),CwZ('.cw-sideBarNav a[data-action="cw-referenceTab"]').remove()};c.prototype.hideToolbarsIfAllowed=function(){if(!this.isMouseNearHotspot){var a=CwZ(".cw-body").hasClass("showSidebar"),b=CwZ(".cw-drop-down-menu").is(":visible");a||b||(CwZ("body").addClass("cw-focus-mode"),CwZ(".guideTipContainer").fadeOut())}this.isMouseNearZoomControl||CwZ("body").addClass("cw-zoom-hide")};
c.prototype.hideToolbarsAfterTimeout=function(){this.toolbarTimeout_&&this.window_.clearTimeout(this.toolbarTimeout_);this.toolbarTimeout_=this.window_.setTimeout(this.hideToolbarsIfAllowed.bind(this),this.HIDE_TIMEOUT)};c.prototype.calculateTooltip=function(a){80>a.clientX||80>a.clientY?(this.isMouseNearHotspot||CwZ("body").removeClass("cw-focus-mode"),this.isMouseNearHotspot=!0):this.isMouseNearHotspot=!1;a.clientX>document.body.clientWidth-80?(this.isMouseNearZoomControl||CwZ("body").removeClass("cw-zoom-hide"),
this.isMouseNearZoomControl=!0):this.isMouseNearZoomControl=!1;window.isCwMobile.any()||this.hideToolbarsAfterTimeout()};c.prototype.initDialogEvents=function(){var a=this,b=this;CWPDFReaderDialog.init();CWPDFReaderConfig.checkReaderMode("drive")&&b.previewFileHandler();CwZ("#cw-pdfReader").on("click",function(a){CwZ(".cw-atl-content").hide();CwZ(".cw-download-content").hide();CwZ(".cw-text-tip").hide()});CwZ("body").on("keyup",function(a){27===a.keyCode&&0<CwZ(".cw-search-menu:visible").length&&
(CwZ(".cw-search-menu").fadeOut("fast"),CWPDFManager.searchText("","",!1),CwZ(".cw-searchBar > input").val(""),CwZ(".cw-searchBar").find("span.searchCount").text(""),CwZ(".cw-searchBar").find("span.searchCount").removeClass("no-match"))});CwZ(".cw-user-holder").off("click").on("click",function(){CwZ(".cw-drop-down-menu").hide();"none"===CwZ(".cw-user-tip").css("display")?CwZ(".cw-user-tip").fadeIn("fast"):CwZ(".cw-user-tip").fadeOut("slow")});CwZ(".cw-user-holder").on("mouseleave",function(){CwZ(".cw-user-tip").fadeOut()});
setTimeout(function(){CwZ(".cw-body").off("mousemove").on("mousemove",function(b){a.calculateTooltip(b)});try{window.addEventListener("mouseout",function(b){b=b?b:window.event;b=b.relatedTarget||b.toElement;b&&"HTML"!==b.nodeName||(a.isMouseNearHotspot=!1,a.isMouseNearZoomControl=!1)})}catch(b){CWUtils.log(b)}},5E3);CwZ(".cw-btn").off("click").on("click",function(a){var d=CwZ(this);if(!d.is(".disable-btn")){var l=d.attr("data-action");if(!(-1<"textSelection;highlight;drawing tools;freehand;rectangle;line;ellipse;arrow;comment".split(";").indexOf(l)&&
b.checkROMode(d,a))){CWDraw.drawMode!==CWDrawMode.TextSelection&&CwZ(".cw-content .cw-pageContainer").attr("onselectstart","return false;");CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode()||CWEventTracker.pushEvent(l);switch(l){case "feedback":0===CwZ(".overlay_feedback").length?(a=CWHtmlStructure.getFeedbackForm(),CwZ(a).prependTo("body"),setTimeout(function(){CwZ(".cw-close-icon").on("click",function(){CwZ(".feedback-head").hide();CwZ(".overlay_feedback").hide()})},1E3)):(CwZ(".feedback-head").show(),
CwZ(".overlay_feedback").show());break;case "myProfile":CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode()?window.open(CWDataCenter.myProfileLink,"_blank"):CWPDFReaderConfig.readerMode===CWPDFReaderMode.Chrome?b.CWIFrameManager.tell("redirectToMyProfile",{message:"redirectToMyProfile",view:"mainExt"}):(a=CWPDFReaderConfig.cwURL+CWUtils.generateEntLinks(b.jsonProfileData.proId,b.jsonProfileData.uName,"101",!1),window.open(a,"_blank"));break;case "logout":CWPDFReaderConfig.checkReaderMode("publisher")||
CWPDFReaderConfig.checkReaderMode("chrome")?b.CWIFrameManager.tell("signoutCall",{message:"signoutCall",view:"mainExt"}):(CWPDFReaderConfig.isCoreMode()?(a='<iframe id="cw-logoutFrame" style="display: none; position: fixed; top: 0px; left:0px; z-index:99999999; border: 0px;" width="100%" height="100%" src="'+(CWPDFReaderConfig.cwURL+"/logout?returnUrl="+encodeURIComponent("/user")+"&ts="+(new Date).getTime())+'"></iframe>',CwZ("#cw-logoutFrame").length&&CwZ("#cw-logoutFrame").remove(),CwZ("body").append(a),
CWDataCenter.isLogin=!1):CWDataCenter.signoutCallToColwiz(),CwZ(".cw-user").hide(),CwZ("#cw-gotoLibrary").hide(),CwZ("#sepGoToLib").hide(),CwZ("#cw-pdfReaderSync").hide(),CwZ(".cw-process").hide());break;case "addlibtip":CwZ("#cw-pdfReaderAdd").hasClass("button-disabled");b.CWIFrameManager.tell("checkDropdownLogin",{view:"mainExt"});break;case "addlib":CwZ("#cw-pdfReaderAdd").hasClass("button-disabled")?window.open(""===b.pubIdUrl?CWPDFReaderConfig.cwURL+"/library":CWPDFReaderConfig.cwURL+"/library?reader=1&pubId="+
b.pubIdUrl,"_blank"):(CwZ(".cw-tip-save-library").hide(),window.clearTimeout(c),c=null,b.CWIFrameManager.tell("addtolib",{message:"Add to Lib",showSignIn:!1,view:"mainExt"}));break;case "gotoLib":window.open(""===b.pubIdUrl?CWPDFReaderConfig.cwURL+"/library":CWPDFReaderConfig.cwURL+"/library?reader=1&pubId="+b.pubIdUrl,"_blank");break;case "downloadpdftip":CwZ(".cw-download-tip .ipdf-bubble-notifier").hide();CWPDFReaderConfig.isCoreMode()?CwZ('.cw-btn[data-action="downloadPdf"]').trigger("click"):
b.CWIFrameManager.tell("checkDownloadLogin",{view:"mainExt"});break;case "downloadPdf":CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode()?CWPDFReaderConfig.checkReaderMode("drive")?null!==CWFileAPICore.file.title?(a=CWUtils.getQueryParam("eid",document.location.href),window.isCwMobile.any()?window.open(CWPDFReaderConfig.cwURL+"/cwc?eId="+a+"&et=31","_blank"):CwZ("#cw-downloadPDF").attr("href",CWPDFReaderConfig.cwURL+"/cwc?eId="+a+"&et=31")):saveAs(CWFileAPICore.fileBlob):CWPDFReaderConfig.checkReaderMode("library")?
(a=CWUtils.getQueryParam("eid",document.location.href),a=CWPDFReaderConfig.cwURL+"/cwc?eId="+a+"&et=28",window.location.href=a):(a="",a=b.getFileDownloadURL(),window.open(a,"_blank")):(CWPDFTour.show("ExtTour"),/^((?!chrome).)*safari/i.test(navigator.userAgent)?(a=CwZ("#cw-pdfURL").attr("value"),window.open(a,"_blank")):b.CWIFrameManager.tell("downloadPDF",{message:"downloadPDF",view:"mainExt"}));break;case "shareFile":a=void 0;"Group"===CWFileAPI.file.type?(a={msg:'Add your friend to this group to share this file with them OR copy this file to your <a href="'+
CWPDFReaderConfig.cwURL+'/app?x=6d6" >Drive</a> to share outside the group.',msgType:"html"},CWPDFReaderDialog.show(a)):CWFileAPI.file.isOwner?shareDialog.showDialog("body"):(a={msg:"You are not the owner of this file. Only the owner of the file is allowed to share files with contacts."},CWPDFReaderDialog.show(a));break;case "sync":b.syncData();break;case "close":CWPDFReaderConfig.isCoreMode()?open(location.toString(),"_self").close():(CWUtils.log("pageHistory:"+history.length),b.CWIFrameManager.tell("closeDialog",
{message:"close",view:"mainExt"}));break;case "zoomOut":if(!b.zoomInProgress){b.zoomInProgress=!0;CWPageManager.fitWidth=!1;CWPageManager.fitHeight=!1;CWPageManager.zoomLevelValue=Math.floor(CWPageManager.zoomLevelValue);var d=200,g=50;window.isCwMobile.any()&&(d=mobileConfig.MIN_ZOOM,g=mobileConfig.ZOOM_STEP);0!==CWPageManager.zoomLevelValue%g&&(a=CWPageManager.zoomLevelValue+(g-CWPageManager.zoomLevelValue%g),CWPageManager.zoomLevelValue=a);CWPageManager.zoomLevelValue>d&&(CWPageManager.zoomLevelValue-=
g,b.setZoom(CWPageManager.zoomLevelValue));setTimeout(function(){b.zoomInProgress=!1},500)}break;case "zoomIn":b.zoomInProgress||(b.zoomInProgress=!0,CWPageManager.fitWidth=!1,CWPageManager.fitHeight=!1,CWPageManager.zoomLevelValue=Math.floor(CWPageManager.zoomLevelValue),d=400,g=50,window.isCwMobile.any()&&(d=mobileConfig.MAX_ZOOM,g=mobileConfig.ZOOM_STEP),0!==CWPageManager.zoomLevelValue%g&&(a=CWPageManager.zoomLevelValue-CWPageManager.zoomLevelValue%g,CWPageManager.zoomLevelValue=a),CWPageManager.zoomLevelValue<
d&&(CWPageManager.zoomLevelValue+=g,b.setZoom(CWPageManager.zoomLevelValue)),setTimeout(function(){b.zoomInProgress=!1},500));break;case "nextPage":CWPageManager.nextPage();break;case "prevPage":CWPageManager.prevPage();break;case "toggleFit":b.zoomInProgress||(b.zoomInProgress=!0,CWPageManager.fitWidth="icon-fit_height"===CwZ(this).find("svg").attr("class"),CWPageManager.fitWidth?(CWPageManager.fitHeight=!0,CWPageManager.fitWidth=!1,CWPageManager.zoomLevelValue=window.isCwMobile.any()?mobileConfig.ZOOM_LEVEL:
75,window.isCwMobile.any()?CWPageManager.setWidthFitScale():CWPageManager.setHeightFitScale(!0),CwZ(this).find("svg").find("use").attr("xlink:href","#icon-fit_width").end().attr("class","icon-fit_width")):(CWPageManager.fitHeight=!1,CWPageManager.fitWidth=!0,window.isCwMobile.any()?CWPageManager.setHeightFitScale(!0):CWPageManager.setWidthFitScale(),CwZ(this).find("svg").find("use").attr("xlink:href","#icon-fit_height").end().attr("class","icon-fit_height")),setTimeout(function(){b.zoomInProgress=
!1},500));break;case "login":b.CWIFrameManager.tell("showLoginFrame",{message:"close",view:"mainExt"});break;case "hand":b.handTool();break;case "textSelection":b.textSelectionTool();break;case "eraser":b.eraserTool();break;case "highlight":b.highlightTool();break;case "freehand":b.freehandTool();break;case "line":b.lineTool();break;case "rectangle":b.rectangleTool();break;case "ellipse":b.ellipseTool();break;case "arrow":b.arrowTool();break;case "comment":b.commentTool();break;case "formatCitation":b.CWIFrameManager.tell("executeFormattedCitation",
{view:"mainExt",source:"pdfFrame"})}b.changeState(l)}}});CwZ(".cw-a-signup").off("click").on("click",function(){CwZ(".cw-tip-save-library").hide();a.CWIFrameManager.tell("showLoginFrame",{message:"close",view:"mainExt"})});CwZ(".cw-search-menu a").off("click").on("click",function(){try{var a=CwZ(this).data("action"),b=CwZ(".cw-searchBar > input")[0].value;switch(a){case "nextMatch":CWUtils.log("nextMatch");CWPDFManager.searchText(b,"again",!1);break;case "prevMatch":CWUtils.log("prevMatch");CWPDFManager.searchText(b,
"again",!0);break;case "hideSearch":CwZ(".cw-search-menu > div").hide(),CwZ(".cw-search-menu > a").hide(),CwZ(".cw-search-menu").fadeOut("fast"),CWPDFManager.searchText("","",!1),CwZ(".cw-searchBar > input").val(""),CwZ(".cw-searchBar > span").text("")}}catch(d){CWPDFReaderConfig.checkReaderMode("library")?PDFRaven.captureException(d.stack):CwZ(document).trigger("cwExcToSentry",d)}});CwZ(".cw-sideBarNav a").off("click").on("click",function(){var a=CwZ(this).attr("data-action");b.toggleSideBar(a)});
CwZ(".cw-sideBar").find("a").off("click").on("click",function(){var a=CwZ(this).attr("data-action");b.toggleSideBar(a)});CwZ(".closeSidebarBtn").off("click").on("click",function(b){a.hideSideBar();CWEventTracker.pushEvent("closeSidebar");CwZ(".referenceHTMLTopDiv").remove()});CwZ(".cw-text-tip-edit .noteDelete").off("mousedown").on("mousedown",function(a){b.deleteComment();a.preventDefault(a)});CwZ(".cw-text-tip > a").off("mousedown").on("mousedown",function(a){a=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./);
var b=0<navigator.userAgent.indexOf("MSIE"),d=0<navigator.userAgent.toLowerCase().indexOf("edge");if(b||a||d)CwZ("body").addClass("iefix"),CWDataHolder.ieSelectedText=window.getSelection().toString();CWDataHolder.selectedTextRange=window.getSelection().getRangeAt(0).cloneRange()});CwZ(".cw-text-tip > a").off("click").on("click",function(a){a.stopImmediatePropagation();a.stopPropagation();var d=CwZ(this).data("action"),c=CwZ(".cw-text-tip");CWUtils.log("cw-text-tip:"+d);switch(d){case "highlight":b.textHighLightOn=
!0;c.hide();CWDraw.drawSelection();CwZ("body").removeClass("iefix");break;case "addNote":b.addNote(a,!0);CwZ("body").removeClass("iefix");break;case "google":b.textHighLightOn=!0;a=window.getSelection().toString();a="https://www.google.com/?gws_rd=cr#q="+encodeURIComponent(a);window.open(a,"_blank");c.hide();break;case "wikipedia":b.textHighLightOn=!0;a=window.getSelection().toString();a="https://en.wikipedia.org/wiki/Special:Search?search="+encodeURIComponent(a);window.open(a,"_blank");c.hide();
break;case "colwiz":a=window.getSelection().toString(),a=CWPDFReaderConfig.cwURL+"/app?x=/home#/app?x=377&q="+encodeURIComponent(a),window.open(a,"_blank"),c.hide()}});CwZ(".cw-menu-items").on("mouseleave",function(){CwZ(".cw-menu-items").fadeOut("slow")});CwZ("#cw-thumbView").on("click",".cw-thumb",function(){var a=CwZ(this).data("page");CWUtils.log(a);var b=0;0<CWPageManager.scale&&(b=CWPageManager.scale/100,b*=CwZ("#cw-page-1").height()+60,CWUtils.log("newH :"+b+" pageNumber : "+a));CWUtils.moveScrollbarTo(".cw-pageContent",
(a-1)*b)});CwZ(".cw-searchBar").find("input").on("keyup",function(a){CWUtils.log(a.keyCode);CWUtils.log(a.target.value);""===a.target.value?(CWPDFManager.searchText("","",!1),CwZ(".cw-searchBar > span").text("")):(CwZ(".cw-annotation").removeClass("cw-selected"),13===a.keyCode?CWPDFManager.searchText(a.target.value,"again",!1):13===a.keyCode&&a.ctrl?CWPDFManager.searchText(a.target.value,"again",!0):CWPDFManager.searchText(a.target.value,"",!1))});CwZ(".cw-clearSearch").off("click").on("click",function(a){a.preventDefault();
CWPDFManager.searchText("","",!1);CwZ(".cw-searchBar > input").val("");CwZ(".cw-searchBar > span").text("")});CwZ(".current-tool").off("click").on("click",function(b){b.stopImmediatePropagation();var d=CwZ(a);a.checkROMode(d,b)||(CwZ(".cw-tools > .cw-btn").removeClass("cw-selected"),d.addClass("cw-selected"),b=d.attr("data-action"),CwZ('.cw-drawing-menu> a[data-action="'+b+'"]').eq(0).trigger("click"))});CwZ(".cw-drop-down > a.cw-btn").on("click",function(){var a=CwZ(this),b=a.closest(".cw-drop-down");
b.find("#current-tool").hasClass("cw-selected")||CwZ(".cw-drop-down > a.cw-btn").removeClass("cw-selected");(b.hasClass("drawing-color")||b.hasClass("cw-stroke-size"))&&CwZ("#current-tool").addClass("cw-selected");b.hasClass("cw-dd-btn")&&CwZ(".cw-btn-hl").addClass("cw-selected");CwZ('.cw-drop-down div[class$="-menu"]').fadeOut("fast");a.is(".cw-selected")?a.next("div").fadeOut("fast",function(){a.removeClass("cw-selected")}):a.next("div").hasClass("cw-atl-content")||(CwZ(".cw-search-menu > div").show(),
CwZ(".cw-search-menu > a").show(),a.next("div").fadeIn("fast",function(){a.addClass("cw-selected")}))});var d=null;CwZ(".cw-drop-down").off("mouseleave").on("mouseleave",function(){var a=CwZ(this);if(!a.hasClass("cw-drop-down-sticky")){var b=a.find("> a.cw-btn");d=setTimeout(function(){a.find(".cw-drop-down-menu").fadeOut("fast");a.find(".cw-caret").removeClass("cw-selected");a.hasClass("cw-dd-btn")||a.hasClass("cw-drawing-tools")||b.removeClass("cw-selected")},1E3)}});CwZ(".cw-drop-down").on("mouseenter",
function(){clearTimeout(d)});CwZ('.cw-drop-down div[class$="-menu"] > a').on("click",function(a){a=CwZ(this).closest(".cw-drop-down");a.find('div[class$="-menu"]').fadeOut("fast");a.find(".cw-caret").removeClass("cw-selected");if(!a.hasClass("cw-drawing-tools")){a.hasClass("cw-stroke-size")?CwZ('.cw-stroke-menu a[class*="active"]').removeClass("active"):a.hasClass("cw-color-picker")?CwZ('.cw-color-menu a[class*="active"]').removeClass("active"):CwZ('.cw-drop-down div[class$="-menu"] > a[class*="active"]').removeClass("active");
CwZ(this).addClass("active");a=a.find(".cw-btn");a.removeClass("cw-selected");var b=CwZ(this).data("color"),d=CwZ(this).data("stroke");b?(CWDraw.colorHL=b,CwZ(".cw-btn-hl").addClass("cw-selected"),CWDraw.color=b,a.find("> .cw-color-icon").css("background",b)):d&&(CWDraw.lineWidth=parseInt(d,10))}});CwZ(".color-pick b").on("click",function(){CwZ(".cw-text-tip").hide();var a=CwZ(this).data("color");CWDraw.colorHL=a;CWDraw.color=a;CwZ(".cw-color-icon").css("background",a)});d=null;CwZ(document).off("cwAnnotationsUpdated").on("cwAnnotationsUpdated",
function(b){return a.doDelayedSync()});CwZ(document).off("cwAnnotationsUpdating").on("cwAnnotationsUpdating",function(b){return a.delaySync()});CwZ(document).off("cwAnnotationAdded").on("cwAnnotationAdded",function(b){return a.onNewCommentAdd()});CwZ(document).off("cwExcToSentry").on("cwExcToSentry",function(a,d){d.view="mainExt";CWPDFReaderConfig.isCoreMode()?PDFRaven.captureException(d.stack):b.CWIFrameManager.tell("sendException",d)});CwZ(".cw-tip-close").on("click",function(){CwZ(".cw-tip-save-library").fadeOut(0);
window.clearTimeout(c)});var c;CwZ("#cw-pdfReaderAdd").on("mouseenter",function(a){var b=this;this.showProgTip=!0;c||(c=window.setTimeout(function(){c=null;b.bMouseOverATLBtn=!0;"none"===CwZ(".cw-user").css("display")&&CwZ(".cw-tip-save-library").fadeIn("slow")},1E3))});CwZ("#cw-pdfReaderAdd").off("mouseover").on("mouseover",function(b){a.showProgTip=!0;a.isProcessing&&a.syncTip&&a.syncTip.show()});CwZ("#cw-pdfReaderAdd").on("mouseleave",function(a){this.showProgTip=!1;this.syncTip&&this.syncTip.is(":visible")&&
this.syncTip.hide();c?(window.clearTimeout(c),c=null):(this.bMouseOverATLBtn=!1,setTimeout(this.hideAddToLibTip,500))});CwZ(".cw-tip-save-library").on("mouseenter",function(a){this.bMouseOverATLTip=!0;this.bMouseOverATLBtn&&CwZ(".cw-tip-save-library").fadeIn(0)});CwZ(".cw-tip-save-library").on("mouseleave",function(a){this.bMouseOverATLTip=!1;setTimeout(this.hideAddToLibTip,500)})};c.prototype.hideAddToLibTip=function(){CwZ(".loading-tip").is(":visible")&&CwZ(".loading-tip").hide();this.bMouseOverATLTip||
this.bMouseOverATLBtn||CwZ(".cw-tip-save-library").fadeOut()};c.prototype.onNewCommentAdd=function(a){CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode()||this.annotationAdded||(CWPDFTour.show("AddToLibTour"),this.annotationAdded=!0,CWEventTracker.pushEvent("annotationPDF"))};c.prototype.syncData=function(a){CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode()?CWDataCenter.syncData():CwZ("#cw-pdfReaderAdd").hasClass("primary-btn-green")&&this.CWIFrameManager.tell("sync",
{message:"syncData",view:"mainExt"})};c.prototype.hasPendingChanges=function(a){var b=this;this.commentsSyncPending=a;if(CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode())if(a)CwZ(window).on("beforeunload",function(a){return b.bPubInLib?"You have unsaved changes. If you leave the page these changes will be lost.":"You have unsaved changes. You can save your changes by adding publication to your library. "});else CwZ(window).off("beforeunload");else this.CWIFrameManager.tell(a?"unsyncedChanges":
"syncedChanges",{bPubInLib:this.bPubInLib,view:"mainExt"})};c.prototype.getTimeSince=function(a){a||(a=new Date);a=Math.floor((parseInt((new Date).toString(),10)-a)/1E3);var b="";if(60>a)return"Few seconds";var d=Math.floor(a/31536E3);0<d&&(a%=31536E3,b+=d+" year ");d=Math.floor(a/2592E3);0<d&&(a%=2592E3,b+=d+" month ");d=Math.floor(a/86400);0<d&&(a%=86400,b+=d+" day ");d=Math.floor(a/3600);0<d&&(a%=3600,b+=d+" hour ");d=Math.floor(a/60);0<d&&(b+=d+" minute ");return b};c.prototype.showSaveToLibrary=
function(){CwZ("#cw-pdfReaderAdd").find("img").addClass("icon-cloud");CwZ("#cw-pdfReaderAdd").find("span").text("Save to wizdom.ai library")};c.prototype.showWaitingMsg=function(){CwZ("#cw-pdfReaderAdd").find("svg").find("use").attr("xlink:href","#icon-process").end().attr("class","icon-process");CwZ("#cw-pdfReaderAdd").removeClass("primary-btn-blue");CwZ("#cw-pdfReaderAdd").addClass("primary-btn");CwZ("#cw-pdfReaderAdd").find("span").text("Adding...")};c.prototype.hideWaitingMsg=function(){CwZ("#cw-pdfReaderAdd").addClass("primary-btn-blue");
CwZ("#cw-pdfReaderAdd").find("svg").find("use").attr("xlink:href","#icon-cloud").end().attr("class","icon-cloud");CwZ("#cw-pdfReaderAdd").removeClass("button-disabled");CwZ("#cw-pdfReaderAdd").find("span").text("Add to Library");CwZ(".listLinkContainer").find("a.addToLib").text("Add to Library")};c.prototype.showSyncMode=function(){CwZ("#saveToLibraryTourTip").hide();CwZ("#cw-pdfReaderAdd").find("svg").find("use").attr("xlink:href","#icon-checkfill").end().attr("class","icon-checkfill");CwZ("#cw-pdfReaderAdd").addClass("button-disabled");
CwZ("#cw-pdfReaderAdd").removeClass("primary-btn");CwZ("#cw-pdfReaderAdd").addClass("primary-btn-green");CwZ("#cw-pdfReaderAdd").find("span").text("View In Library");CWPDFTour.show("ExtTour");CwZ("#cw-gotoLibrary").css("display","inline-block");CwZ(".cw-user").css("display","inline-block")};c.prototype.showAddMode=function(){CwZ("#cw-pdfReaderAdd").show();CwZ("#cw-pdfReaderSync").hide();CwZ("#cw-gotoLibrary").hide();CwZ("#cw-pdfReaderAdd").removeClass("button-disabled");CwZ("#cw-pdfReaderAdd").removeClass("primary-btn-green");
CwZ("#cw-pdfReaderAdd").addClass("primary-btn-blue");CwZ("#sepGoToLib").hide()};c.prototype.showProgress=function(a,b,d){var c,e,f;c=CwZ(".cw-btn-group.cw-pull-right:first");c.addClass("add-to-library");f=c.find(".loading-tip");e=f.find(".level");if("sync"===a)void 0===b&&(b="Syncing.."),this.isProcessing=!0,this.syncTip=f,c.find(".tip-txt").html(b);else if("progress"===a||"addPub"===a)this.isProcessing=!0,this.syncTip=f,c.find(".tip-txt").html(b),CwZ("#cw-pdfReaderAdd").addClass("button-disabled"),
CwZ("#cw-pdfReaderAdd").find("span").text(b),this.showWaitingMsg(),e.width(d+"%"),0<=b.indexOf("success")&&(this.isProcessing=this.showProgTip=!1)};c.prototype.hideSyncing=function(){this.syncDisplayTimer&&clearInterval(this.syncDisplayTimer);var a=CwZ("#cw-pdfReaderSync .cw-span-synced"),b=CwZ("#cw-pdfReaderSync .cw-span-syncing");a.removeClass("hidden");a.css("display","inline-block");b.hide("fast");b.addClass("hidden");CwZ("#cw-pdfReaderSync").removeClass("syncing");this.hasPendingChanges(!1)};
c.prototype.hideProgress=function(a){var b=this,d=CwZ(".cw-btn-group.cw-pull-right:first"),c=d.find(".loading-tip"),e=c.find(".level");void 0===a&&(a=0);setTimeout(function(){CwZ(".cw-process, .cw-process .cw-progress, .cw-sync").hide();CwZ(".cw-progress i").width("0%");d.removeClass("add-to-library");c.hide();e.width("0%");b.hideSyncing()},a)};c.prototype.initializeScrollContent=function(){try{if(CWUtils.updateScrollbar(document,CWPageManager.handleScroll),CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode()){0>
CWPDFReaderConfig.dataImgURL.indexOf("http")&&0>CWPDFReaderConfig.cwURL.indexOf("drive.colwis.org")&&(CWPDFReaderConfig.dataImgURL="https:"+CWPDFReaderConfig.dataImgURL);var a=void 0,a=CWPDFReaderConfig.dataImgURL+"t/101/"+CWPDFReaderConfig.proId+".jpg?"+Math.floor((new Date).valueOf()/1E3);-1!==CWPDFReaderConfig.cwURL.indexOf("ro.colwis.org")&&(a=CWPDFReaderConfig.cwURL+a);var b={};b.pts=CWPDFReaderConfig.pts;b.uName=CWPDFReaderConfig.uName;b.userImgURL=a;this.updateUserImage(b)}}catch(d){CWUtils.log(d)}};
c.prototype.updateUserImage=function(a){try{"0"===a.pts||void 0===a.pts?CwZ("#cw-userImage").attr("src",CWPDFReaderConfig.cwURL+"/images/spacer.gif").attr("title",a.uName):CwZ("#cw-userImage").attr("src",a.userImgURL).attr("title",a.uName)}catch(b){CwZ("#cw-userImage").attr("src","").attr("title",a.uName)}};c.prototype.launchFullScreen=function(){var a=document.documentElement;a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()};
c.prototype.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};c.prototype.changeReaderLogo=function(){if(CWPDFReaderConfig.checkReaderMode("publisher")){var a=window.parent.colwizOptions;CwZ("#cw-readerLogo").addClass(publisher.logoClass?publisher.logoClass:a.darkLogoURL)}};c.prototype.applyReaderOptions=function(a){a||(a={});a.readerOptions=
CwZ.extend({},{sideBarVisible:!1,tools:{dragPage:!0,textSelection:!0,drawHighlight:!0,eraser:!0,pencil:!0,rectangle:!0,ellipse:!0,arrow:!0,line:!0,comments:!0,download:!0},fullScreenMode:!1,shareTabShow:!1,citeTabShow:!1,relatedTabShow:!1},a.readerOptions);CWPDFReaderConfig.readerMode===CWPDFReaderMode.Chrome&&(a.readerOptions.relatedTabShow=!0,a.readerOptions.citeTabShow=!0);CWPDFReaderConfig.readerMode===CWPDFReaderMode.Library&&(a.readerOptions.referenceTabShow=!1);var b=a.readerOptions;a=a.readerOptions.tools;
a.dragPage||CwZ('.cw-btn[data-action="hand"]').hide();a.textSelection||CwZ('.cw-btn[data-action="textSelection"]').hide();a.drawHighlight||CwZ('.cw-btn[data-action="highlight"]').parent().hide();a.eraser||CwZ('.cw-btn[data-action="eraser"]').hide();a.download||CwZ('.cw-btn[data-action="downloadPdf"]').hide();a.pencil||a.rectangle||a.ellipse||a.arrow||a.line||a.comments||CwZ(".cw-drawing-tools").hide();a.pencil||CwZ('.cw-drawing-menu a[data-action="freehand"]').hide();a.rectangle||CwZ('.cw-drawing-menu a[data-action="rectangle"]').hide();
a.ellipse||CwZ('.cw-drawing-menu a[data-action="ellipse"]').hide();a.arrow||CwZ('.cw-drawing-menu a[data-action="arrow"]').hide();a.line||CwZ('.cw-drawing-menu a[data-action="line"]').hide();a.comments||CwZ('.cw-drawing-menu a[data-action="comment"]').hide();b.searchBarVisible&&CwZ(".cw-header-search").removeClass("hidden");b.addToLibraryShow&&CwZ(".cw-atl-tip").removeClass("hidden");b.referenceTabShow||(CwZ('.cw-sideBarNav a[data-action="cw-referenceTab"]').remove(),CwZ(".cw-tabNavigator .cw-referenceTab").remove());
b.shareTabShow||(CwZ('.cw-sideBarNav a[data-action="cw-shareTab"]').remove(),CwZ(".cw-tabNavigator .cw-shareTab").remove());b.citeTabShow||(CwZ('.cw-sideBarNav a[data-action="cw-citeTab"]').remove(),CwZ(".cw-tabNavigator .cw-citeTab").remove());b.relatedTabShow||(CwZ('.cw-sideBarNav [data-action="cw-relatedTab"]').remove(),CwZ(".cw-tabNavigator .cw-relatedTab").remove());CwZ('.cw-sideBarNav [data-action="cw-authorTab"]').remove();CwZ(".cw-tabNavigator .cw-authorTab").remove();b.readerSamePage&&CwZ(".userMenu .close-btn").removeClass("hidden");
b.hideReaderLogo&&CwZ("header .logo").remove();b.hideDownloadButton&&CwZ("#cw-downloadPDF").remove();b.hideReaderAvater&&CwZ(".cw-user").remove()};c.prototype.openViewInLibraryWindow=function(a){if(this.viewInLibraryWindow=window.open("","_blank"))this.viewInLibraryWindow.location=a};c.prototype.closeViewInLibraryWindow=function(){this.viewInLibraryWindow&&this.viewInLibraryWindow.close()};c.prototype.updateUser=function(a){if(a)if(void 0===a.userImgURL||""===a.userImgURL)void 0===a.uName||""===a.uName?
(this.showAddMode(),CwZ(".cw-user").hide(),CwZ("#cw-gotoLibrary").hide(),CwZ("#sepGoToLib").hide(),CwZ(".cw-process").hide()):(CwZ(".cw-user").show(),CwZ("#cw-gotoLibrary").show(),CwZ("#sepGoToLib").show());else{try{this.updateUserImage(a)}catch(b){CwZ("#cw-userImage").attr("src","").attr("title",a.uName)}CwZ(".cw-user").css("display","");CwZ("#cw-gotoLibrary").css("display","");CwZ("#sepGoToLib").show()}};c.prototype.hasPubInLib=function(){this.bPubInLib=!0;this.showSyncMode()};c.prototype.getFileDownloadURL=
function(){var a=CwZ("#cw-pdfURL").attr("value");CWUtils.log("getFileDownloadURL pdfURL:"+a);return void 0===a||null===a?"":a};c.prototype.logConsole=function(a,b,d){CWlogger.logConsole(a,b,d)};c.prototype.toggleTool=function(){switch(CWDataHolder.oldDrawMode){case CWDrawMode.Freehand:this.freehandTool();break;case CWDrawMode.Line:this.lineTool();break;case CWDrawMode.Rectangle:this.rectangleTool();break;case CWDrawMode.Highlight:this.highlightTool();break;case CWDrawMode.Ellipse:this.ellipseTool();
break;case CWDrawMode.Arrow:this.arrowTool();break;case CWDrawMode.Eraser:this.eraserTool();break;case CWDrawMode.Comment:this.commentTool();break;case CWDrawMode.TextSelection:this.textSelectionTool()}};c.prototype.toggleSideBar=function(a){if(a){CWEventTracker.pushEvent(a.replace("cw-",""));var b=!1;CwZ(".cw-body").hasClass("showSidebar")||(b=!0);b?(this.showSideBar(a),CwZ(".referenceHTMLTopDiv").remove()):CwZ(".cw-sideBar .show").hasClass(a)?(this.hideSideBar(),CwZ(".referenceHTMLTopDiv").remove()):
(CwZ(".cw-sideBar .show").removeClass("show"),CwZ(".cw-tabNavigator .cw-tab").removeClass("active"),CwZ.each(CwZ(".cw-tabContainer .cw-tabData"),function(){CwZ(this).hasClass(a)&&CwZ(this).addClass("show")}),CwZ.each(CwZ(".cw-tabNavigator .cw-tab"),function(){if(CwZ(this).hasClass(a)){if(0<CwZ("[data-tooltip-temp]").length){var b=CwZ(CwZ("[data-tooltip-temp]")[0]).attr("data-tooltip-temp");CwZ(CwZ("[data-tooltip-temp]")[0]).removeAttr("data-tooltip-temp").attr("data-tooltip",b)}CwZ(this).addClass("active");
b=CwZ(this).attr("data-tooltip");CwZ(".cw-tabHeading").text(b);CwZ(this).removeAttr("data-tooltip").attr("data-tooltip-temp",b)}}));"cw-relatedTab"===a&&0<CwZ(".cw-sideBarNav .ipdf-bubble-notifier:visible").length&&CwZ(".cw-sideBarNav .ipdf-bubble-notifier:visible").hide()}};c.prototype.hideSideBar=function(){CwZ(".cw-body").removeClass("showSidebar");setTimeout(function(){CWUtils.updateScrollbar(document,CWPageManager.handleScroll)},300)};c.prototype.showSideBar=function(a){if(0<CwZ("[data-tooltip-temp]").length){var b=
CwZ(CwZ("[data-tooltip-temp]")[0]).attr("data-tooltip-temp");CwZ(CwZ("[data-tooltip-temp]")[0]).removeAttr("data-tooltip-temp").attr("data-tooltip",b)}CwZ(".cw-sideBar .cw-tabContainer .cw-tabData").removeClass("show");CwZ(".cw-tabNavigator .cw-tab").removeClass("active");CwZ.each(CwZ(".cw-sideBar .cw-tabContainer .cw-tabData"),function(){CwZ(this).hasClass(a)&&CwZ(this).addClass("show")});CwZ.each(CwZ(".cw-tabNavigator .cw-tab"),function(){if(CwZ(this).hasClass(a)){CwZ(this).addClass("active");var b=
CwZ(this).attr("data-tooltip");CwZ(".cw-tabHeading").text(b);b=CwZ(this).attr("data-tooltip");CwZ(this).removeAttr("data-tooltip").attr("data-tooltip-temp",b)}});CwZ(".cw-body").addClass("showSidebar")};c.prototype.handTool=function(){var a=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),b=0<navigator.userAgent.indexOf("MSIE"),a=a||b?"cw-content cw-pointer-hand-IE":"cw-content cw-pointer-hand";CWDraw.drawMode=CWDrawMode.Drag;CwZ("#cw-pdfReader .cw-content").attr("class",a);CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");
CwZ(this).addClass("cw-selected");this.toggleToolOptions(!1,!1)};c.prototype.textSelectionTool=function(){var a=CwZ('.cw-btn[data-action="textSelection"]');CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.TextSelection;CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-text");CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");a.addClass("cw-selected");CwZ(".cw-content .cw-pageContainer").removeAttr("onselectstart");this.toggleToolOptions(!1,
!1)};c.prototype.highlightTool=function(){CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Highlight;CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-cross");CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");CwZ(".cw-btn-hl").addClass("cw-selected");this.toggleToolOptions(!0,!1);this.setDDTool("highlight","icon-highlighter","Highlight")};c.prototype.addNote=function(a,b){var d=CwZ(".cw-text-tip-edit > i");CwZ(".cw-text-tip").hide();b&&CWDraw.drawSelection();
var c=CwZ("#"+CWAnnotate.hashComment[CWDataHolder.currentComment.ID])[0].getBoundingClientRect(),e=c.left+c.width/2-CwZ(".cw-text-tip-edit").width()/2,f=c.top-CwZ(".cw-text-tip-edit").outerHeight()-CwZ(".cw-text-tip-edit i").outerHeight();0>=e?(e=10,d.css("left",10)):e+CwZ(".cw-text-tip-edit").width()>=window.innerWidth?(e=window.innerWidth-CwZ(".cw-text-tip-edit").width()-20,d.css("left",CwZ(".cw-text-tip-edit").width()-20)):d.css("left",CwZ(".cw-text-tip-edit").width()/2);0>=f?(f=c.bottom+10,d.removeClass("carret-down").addClass("carret-up")):
f+CwZ(".cw-text-tip-edit").height()>=window.innerHeight?(f=window.innerHeight-CwZ(".cw-text-tip-edit").height()-10,d.removeClass("carret-down").addClass("carret-up")):d.removeClass("carret-up").addClass("carret-down");f+=window.scrollY||window.pageYOffset;CwZ(".cw-text-tip-edit").css("left",e);CwZ(".cw-text-tip-edit").css("top",f);CwZ(".cw-text-tip-edit").show();CwZ(".cw-text-tip-edit textarea").val("");CwZ(".cw-text-tip-edit textarea").trigger("focus")};c.prototype.eraserTool=function(){var a=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),
b=0<navigator.userAgent.indexOf("MSIE"),a=a||b?"cw-content cw-pointer-eraser-IE":"cw-content cw-pointer-eraser";CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Eraser;CwZ("#cw-pdfReader .cw-content").attr("class",a);CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");CwZ(this).addClass("cw-selected");this.toggleToolOptions(!1,!1)};c.prototype.freehandTool=function(){CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Freehand;CwZ("#cw-pdfReader .cw-content").attr("class",
"cw-content cw-pointer-cross");CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");this.toggleToolOptions(!0,!0);this.setDDTool("freehand","icon-pencil","Pencil")};c.prototype.lineTool=function(){CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Line;CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-cross");CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");this.toggleToolOptions(!0,!0);this.setDDTool("line",
"icon-line","Straight Line")};c.prototype.rectangleTool=function(){CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Rectangle;CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-cross");CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");this.toggleToolOptions(!0,!0);this.setDDTool("rectangle","icon-rectangle","Rectangle")};c.prototype.ellipseTool=function(){CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Ellipse;CwZ("#cw-pdfReader .cw-content").attr("class",
"cw-content cw-pointer-cross");CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");this.toggleToolOptions(!0,!0);this.setDDTool("ellipse","icon-oval","Ellipse")};c.prototype.arrowTool=function(){CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Arrow;CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-cross");CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");this.toggleToolOptions(!0,!0);this.setDDTool("arrow",
"icon-arrow","Arrow")};c.prototype.commentTool=function(){var a=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),b=0<navigator.userAgent.indexOf("MSIE"),a=a||b?"cw-content cw-pointer-comment-IE":"cw-content cw-pointer-comment";CWDraw.drawMode=CWDataHolder.oldDrawMode=CWDrawMode.Comment;CwZ("#cw-pdfReader .cw-content").attr("class",a);CwZ(".cw-tools .cw-selected,.cw-drawing-tools .cw-selected").removeClass("cw-selected");this.toggleToolOptions(!1,!1);this.setDDTool("comment","icon-addcomment","Comment")};
c.prototype.setZoom=function(a){var b=CwZ("body"),b={current:{y:b.scrollTop(),x:b.scrollLeft()}};void 0!==b&&(CWPageManager.scrollPosition=b.current);CWPageManager.scale=parseInt(a,10);CWPageManager.scalePage(!0)};c.prototype.setDDTool=function(a,b,d){var c=CwZ("#current-tool");c.attr("data-action",a);c.find("svg:first").attr("class",b);c.find("use").attr("xlink:href","#"+b);d&&c.attr("data-tooltip",d);c.addClass("cw-selected")};c.prototype.toggleToolOptions=function(a,b){var d=CwZ(".cw-property");
if(a||b){if(a?d.find(".cw-color-picker").show():d.find(".cw-color-picker").hide(),b?d.find(".cw-stroke-size").show():d.find(".cw-stroke-size").hide(),a||b)d.css("left","0"),d.fadeIn(200)}else d.css("left","-30"),d.fadeOut(200)};c.prototype.showAnnotText=function(a){var b=CwZ(".cw-text-tip-edit");if(a instanceof SVGRectElement||a instanceof SVGPathElement||a instanceof SVGEllipseElement||a instanceof SVGPathElement||a instanceof SVGLineElement||a.parentElement instanceof SVGGElement){var d=a.getBoundingClientRect(),
c=d.left+d.width/2-b.outerWidth()/2,e=CwZ(".cw-text-tip-edit > i"),f=d.top-b.outerHeight()-e.outerHeight();0>=c?(c=10,b.css("left",10)):c+b.outerWidth()>=window.innerWidth?(c=window.innerWidth-b.outerWidth()-20,e.css("left",b.outerWidth()-20)):e.css("left",b.outerWidth()/2);0>=f?(f=d.bottom+10,e.removeClass("carret-down").addClass("carret-up")):f+b.height()>=window.innerHeight?(f=window.innerHeight-b.height()-10,e.removeClass("carret-down").addClass("carret-up")):e.removeClass("carret-up").addClass("carret-down");
d=CwZ(window).scrollTop();f+=d;d=void 0;try{d=CWCommentManager.getCommentById(CWAnnotate.hashSVG[a.id])||CWCommentManager.getCommentById(CWAnnotate.hashSVG[a.parentElement.id])}catch(l){a=CwZ("#"+a.id).closest("g").attr("id"),d=CWCommentManager.getCommentById(CWAnnotate.hashSVG[a])}CWDataHolder.currentComment=d;a=(d||{}).cmt;b.find("textarea").val(a);b.css("left",c);b.css("top",f);b.show();CWPDFTour.isElementInView(b[0])||b.css("top",f-2*CwZ("header").height());window.isCwMobile.any()||CwZ(".cw-text-tip-edit textarea").trigger("focus")}window.isCwMobile.iOS()&&
(b.css("left",document.body.scrollLeft+20*window.innerWidth/document.documentElement.clientWidth),b.css("transform","scale("+window.innerWidth/document.documentElement.clientWidth+")"),b.css("top",document.body.scrollTop+(document.body.clientHeight>>1)-(CwZ(".cw-text-tip-edit").height()>>1)))};c.prototype.deleteComment=function(){CWPDFReaderConfig.checkReaderMode("drive")&&CWDataCenter.isReadOnly||(CWCommentManager.deleteShape((CWDataHolder.currentComment||{}).ID,!0),CwZ(".cw-text-tip-edit").hide())};
c.prototype.changeState=function(a){try{if(""!==a||null!=a)this.pdfState.lastAction=a;this.pdfState.zoomLevel=CWPageManager.getActualZoom(!0).toString();this.pdfState.scrollPosX=CwZ("body").scrollLeft();this.pdfState.scrollPosY=CwZ("body").scrollTop();this.pdfState.toolSelected=CwZ("header .cw-selected").attr("data-action");this.pdfState.currentPageNumber=CWPageManager.currentPage;this.pdfState.lastSelectedCommentID="";this.pdfState.sideBarVisible=0<=parseInt(CwZ(".cw-sideBar").css("right").replace("px",
""),10)?!0:!1;this.pdfStateString=JSON.stringify(this.pdfState)}catch(b){CWUtils.log(b)}};c.prototype.goToPreviousState=function(a){try{a=CwZ.parseJSON(a.state),this.setZoom(a.zoomLevel),this.changeToolSelection(a.toolSelected),setTimeout(function(){CWUtils.moveScrollbarTo(".cw-pageContent",a.scrollPosY,!0)},1E3)}catch(b){CWUtils.log(b)}};c.prototype.changeToolSelection=function(a){switch(a){case "hand":this.handTool();break;case "textSelection":this.textSelectionTool();break;case "eraser":this.eraserTool();
break;case "highlight":this.highlightTool();break;case "freehand":this.freehandTool();break;case "line":this.lineTool();break;case "rectangle":this.rectangleTool();break;case "ellipse":this.ellipseTool();break;case "arrow":this.arrowTool();break;case "comment":this.commentTool()}};c.prototype.pageCounterHandler=function(){function a(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))}var b=0;CWPageManager.pgHeights.map(function(a){b+=a});var c=b/CWPageManager.pgHeights.length,k=window.isCwMobile.any()?
mobileConfig.SCALE:CWPageManager.scale/100,e;e=(c+30)/k;var c=document.body.scrollTop,f=c+document.body.clientHeight;e=Math.floor((c+document.body.clientHeight)/e);0===e&&(e=1);2<CWPageManager.totalPages&&e>CWPageManager.totalPages-2&&(e=CWPageManager.totalPages-2);var l=document.getElementById("cw-page-"+e),g=document.getElementById("cw-page-"+(e+1)),h=document.getElementById("cw-page-"+(e+2)),m,r,p,q,n,t;l&&(m=l.offsetTop,r=m+l.offsetHeight,m/=k,r/=k);g&&(p=g.offsetTop,q=p+g.offsetHeight,p/=k,q/=
k);h&&(n=h.offsetTop,t=n+h.offsetHeight,n/=k,t/=k);k=a({x:c,y:f},{x:m,y:r});p=a({x:c,y:f},{x:p,y:q});n=a({x:c,y:f},{x:n,y:t});n!==n&&(n=999999);switch(Math.min(k,p,n)){case k:CWPageManager.currentPage=e;break;case p:CWPageManager.currentPage=e+1;break;case n:CWPageManager.currentPage=e+2}0===c?CWPageManager.currentPage=1:document.body.scrollTop+document.body.clientHeight===document.body.scrollHeight&&(CWPageManager.currentPage=CWPageManager.totalPages);2===CWPageManager.currentPage&&CWPDFTour.show("ReferenceTour");
CwZ(".cw-page-counter input").attr("placeholder",CWPageManager.currentPage+"/"+CWPageManager.totalPages)};c.prototype.setRelatedPubs=function(a){var b=this;if(a){var c=a.data.data.value;-1===c.indexOf("no-result-cw")&&1<c.length?CwZ(c).find(".listLinkContainer").length?(CwZ(".cw-relatedTab .relList").html(c),c=CwZ(".cw-relatedTab .relList li").length,CwZ(".cw-sideBarNav .ipdf-bubble-notifier").text(c).fadeIn(),CwZ(".relList .addToLib").on("click",function(a){CWEventTracker.pushEvent("addRelatedPub");
b.relatedAddToLib(a)}),CwZ(".relList .viewArticle").on("click",function(){CWEventTracker.pushEvent("viewRelatedPub")}),CwZ(".relList .findArticle").on("click",function(){CWEventTracker.pushEvent("findRelatedPub")}),CwZ(".relList li").each(function(a){a=CwZ(this);var b=-1!==a.find(".year").text().indexOf("1900-01-01")?a.find(".info .journal").length?'<span class="journal">'+a.find(".info .journal").html()+"</span>":"":a.find(".info").html();a.find(".info").html(b)})):(CwZ('.cw-sideBarNav [data-action="cw-relatedTab"]').remove(),
CwZ(".cw-tabNavigator .cw-relatedTab").remove()):(CwZ('.cw-sideBarNav [data-action="cw-relatedTab"]').remove(),CwZ(".cw-tabNavigator .cw-relatedTab").remove())}else try{var k=this.pubOpened;if(1<k.title.length){var e='"'+k.authors.replace(/; /g,'","')+'"',f=k.identifier.split("/")[0],c="(title:("+Base64.decode(k.title).replace(/([\!\*\+\&\|\(\)\[\]\{\}\^\~\?\:\"])/g,"\\$1")+") "+(1<e.length?"OR authors:("+e.replace(/([\!\*\+\&\|\(\)\[\]\{\}\^\~\?\:\"])/g,"\\$1")+")) ":"")+(1<f.length?"AND doi:"+f+
'* NOT doi:"'+k.identifier+'"':"");a=void 0;a=CWDataHolder.isLogin?CWPDFReaderConfig.cwURL+"/app?x=3de&q="+encodeURIComponent(c)+"&a=all&t=pu&aj=1&webpdfrelpubs=1&_lmt=40":CWPDFReaderConfig.cwURL+"/public/app?x=/related&q="+encodeURIComponent(c)+" &sort=score%20desc,%20eucount%20desc&a=all&exclude=-1&ajax=1&pubsolref=1";CWPDFReaderConfig.readerMode!==CWPDFReaderMode.Publisher&&CWPDFReaderConfig.readerMode!==CWPDFReaderMode.Chrome||this.CWIFrameManager.tell("getRelatedPubs",{message:{url:a},view:"mainExt"})}else CwZ('.cw-sideBarNav [data-action="cw-relatedTab"]').hide(),
CwZ(".cw-tabNavigator .cw-relatedTab").hide()}catch(l){CwZ('.cw-sideBarNav [data-action="cw-relatedTab"]').remove(),CwZ(".cw-tabNavigator .cw-relatedTab").remove()}};c.prototype.relatedAddToLib=function(a,b){if(b)-1!==b.resp.indexOf("success")&&CwZ("#"+b.eId+" .addToLib").text("View in Library");else{var c=CwZ(a.target).closest("li").attr("id");"Add to Library"===a.target.text?(CwZ(a.target).text("Adding..."),this.CWIFrameManager.tell("addRelatedPub",{eId:c,view:"mainExt"})):"View in Library"===a.target.text&&
window.open(""===this.pubIdUrl?CWPDFReaderConfig.cwURL+"/library":CWPDFReaderConfig.cwURL+"/library?reader=1&pubId="+c,"_blank")}};c.prototype.ajaxCallback=function(a){CWDataHolder.cbFunc().get(a.fId)(a.response)};c.prototype.authorLinkClick=function(a){CwZ(a.target).attr("auid")};return c}();
CWPDFReaderConfig.isCoreMode()||CWPDFReaderConfig.isDesktopMode()||CWPDFReaderConfig.readerMode===CWPDFReaderMode.Chrome||CwZ(document).ready(function(){try{var c=function(){CWPDFReader?CWPDFReader.bInitDone||(CWPDFReader.init(),CWPDFReader.bInitDone=!0):setTimeout(function(){c()},500)};c()}catch(a){CWUtils.log(a),CwZ(document).trigger("cwExcToSentry",a)}});
try{var wheelCheck=function(c){CWPDFReader.ctrlKey&&(c.preventDefault(),CWPDFReader.mouseWheelMoving||(CWPDFReader.mouseWheelMoving=!0,CWPageManager.zoomLevelValue=Math.floor(CWPageManager.zoomLevelValue),0!==CWPageManager.zoomLevelValue%25&&(CWPageManager.zoomLevelValue-=CWPageManager.zoomLevelValue%25),c.wheelDelta?0<c.wheelDelta?400>CWPageManager.zoomLevelValue&&(CWPageManager.zoomLevelValue+=50):200<CWPageManager.zoomLevelValue&&(CWPageManager.zoomLevelValue-=50):c.detail&&(0<c.detail?200<CWPageManager.zoomLevelValue&&
(CWPageManager.zoomLevelValue-=50):400>CWPageManager.zoomLevelValue&&(CWPageManager.zoomLevelValue+=50)),200<=CWPageManager.zoomLevelValue&&400>=CWPageManager.zoomLevelValue&&CWPDFReader.setZoom(CWPageManager.zoomLevelValue)),setTimeout(function(a){CWPDFReader.mouseWheelMoving=!1},1E3))},doneResizing=function(){CWPageManager.fitWidth?CWPageManager.setWidthFitScale():CWPageManager.fitHeight&&CWPageManager.setHeightFitScale(!0)};window.onblur=function(){CWPDFReader.mouseWheelMoving=!1;CWPDFReader.ctrlKey=
!1;CWPDFReader.zoomInProgress=!1};var resizeId_1;window.addEventListener("resize",function(){clearTimeout(resizeId_1);resizeId_1=setTimeout(doneResizing,500)});CwZ(document).on("keydown",function(c){CWPDFReader.ctrlKey&&70===c.keyCode?(c.preventDefault(),CWPDFReader.zoomInProgress||(CWPDFReader.zoomInProgress=!0,CwZ('a[data-action="search"]').trigger("click"),CwZ(".cw-searchBar input").eq(0).trigger("focus")),setTimeout(function(){CWPDFReader.zoomInProgress=!1},1E3)):CWPDFReader.ctrlKey&&65===c.keyCode&&
CwZ(".cw-text-tip").hide();46===c.keyCode&&CWDataHolder.canvasMStates.onShape?(c.preventDefault(),c=CWAnnotate.hashSVG[CWDraw.itemToDel.node.id],CwZ(".cw-delete-btn").hide(),CWDraw.deleteAnn(c),CWDraw.itemToDel.remove(),CwZ(".cw-text-tip-edit").hide(),CWDataHolder.canvasMStates.onShape=!1):CWPDFReader.ctrlKey&&107===c.keyCode?(c.preventDefault(),CWPDFReader.zoomInProgress||(CWPDFReader.zoomInProgress=!0,CWPageManager.zoomLevelValue=Math.floor(CWPageManager.zoomLevelValue),0!==CWPageManager.zoomLevelValue%
25&&(c=CWPageManager.zoomLevelValue-CWPageManager.zoomLevelValue%25,CWPageManager.zoomLevelValue=c),200>CWPageManager.zoomLevelValue&&(CWPageManager.zoomLevelValue+=25,CWPDFReader.setZoom(CWPageManager.zoomLevelValue))),setTimeout(function(){CWPDFReader.zoomInProgress=!1},1E3)):CWPDFReader.ctrlKey&&109===c.keyCode?(c.preventDefault(),CWPDFReader.zoomInProgress||(CWPDFReader.zoomInProgress=!0,CWPageManager.zoomLevelValue=Math.floor(CWPageManager.zoomLevelValue),0!==CWPageManager.zoomLevelValue%25&&
(c=CWPageManager.zoomLevelValue+(25-CWPageManager.zoomLevelValue%25),CWPageManager.zoomLevelValue=c),100<CWPageManager.zoomLevelValue&&(CWPageManager.zoomLevelValue-=25,CWPDFReader.setZoom(CWPageManager.zoomLevelValue))),setTimeout(function(){CWPDFReader.zoomInProgress=!1},1E3)):CWDraw.mouseEnabled&&CWAnnotate.mouseDownPage===CWAnnotate.mouseMovePage?(c.preventDefault(),c.stopPropagation(),32!==c.keyCode&&33!==c.keyCode&&34!==c.keyCode&&38!==c.keyCode&&40!==c.keyCode||c.stopPropagation()):c.ctrlKey&&
(CWPDFReader.ctrlKey=!0)});CwZ(document).on("keyup",function(c){17===c.keyCode&&(CWPDFReader.ctrlKey=!1)});document.addEventListener("mousewheel",function(c){return wheelCheck(c)},!1);document.addEventListener("DOMMouseScroll",function(c){return wheelCheck(c)},!1)}catch(ex$$3){CWUtils.log(ex$$3)}
var CWDataHolderClass=function(){function c(){this.pageCounterDelay=2E3;this.isOnPageCounter=!1;this.oldDrawMode=11;this.canvasMStates={mDown:!1,onShape:!1,shapeMoved:!1};this.oldScrollPos={x:0,y:0};this.lastActivity={scroll:(new Date).getTime(),click:(new Date).getTime()};this.hasSuppMaterial=this.authorsRequested=!1;this.ieSelectedText="";this.customAnnotLinks=[];this.authorsArr=[]}c.prototype.cbFunc=function(){return{get:function(a){var b=this.cbFuncHolder[a];delete this.cbFuncHolder[a];return b},
set:function(a){this.cbFuncHolder||(this.cbFuncHolder={});var b=(new Date).getTime()+(Math.floor(19*Math.random())+1);this.cbFuncHolder[b]=a;return b}}};c.prototype.getAuthorsArr=function(){var a=this,b=CwZ.Deferred();this.authorsRequested?b.resolve(this.authorsArr):(this.authorsRequested=!0,0<CWDataHolder.authorsArr.length?b.resolve(this.authorsArr):CWPDFReaderConfig.readerMode===CWPDFReaderMode.Publisher&&CwZ.get(CWPDFReaderConfig.cwURL+"/auapi?q=doi:"+window.parent.CWDataCenter.pubSelected.identifier+
"&appId="+window.parent.publisher.appId).done(function(c){0<c.Authors.length&&c.Authors.map(function(b){a.authorsArr[b.id]=b});b.resolve(a.authorsArr)}).fail(function(){b.resolve(a.authorsArr)}));return b.promise()};return c}(),CWDataHolder=new CWDataHolderClass,CWPDFDataImporter=function(){function c(a){this.page=a}c.prototype.getIdentifier=function(a){this.page.getTextContent().then(function(b){for(var c="",k="",e="",f="",l="",g="",h=0;h<b.items.length;h++)g+=b.items[h].str;b=new RegExp(/(10.(\d)+\ ?\/ ?(\S)+\d[^A-Z.\s])/g);
h=RegExp(".*?(arXiv:[\\.\\w]+).*","g");b.test(g)?f=g.match(b)[0].replace(/ /g,""):h.test(g)&&(l=g.match(/:(.*)v/)[0],l=l.replace(":",""),l=l.replace("v",""));""===c&&(c=f);if(""===c)try{k=l}catch(m){}""===c&&""===e&&(e="");a({doi:c,arxivId:k,title:e})})};c.prototype.process=function(){var a={};if(CWPDFReaderConfig.checkReaderMode("chrome")){var b=CWPDFReader.pubOpened;/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})([=]{1,2})?$/.test(b.title)?a.title=Base64.decode(b.title):
a.title=b.title;a.authors=b.authors;a.abs=b.otherInfo;a.keywords=b.keywords;var c;c=""+(b.journal?b.journal+", ":"");c+=b.year?b.year:"";c+=b.volume?", vol. "+b.volume+", ":"";c+=b.issue?b.issue:"";c+=b.edition?b.edition:"";c+=b.page?"pp. "+b.page:"";a.journalText=c}else if(CWPDFReaderConfig.checkReaderMode("librarydesktop")){if(CWApiHandler.pub){var b=CWApiHandler.pub,k=CwZ("#cw-citeTab");k.find(".pub-title").text(b.title);c=b.ext.description?b.ext.description:"";k.find(".pub-abstract").text(c);
k.find(".pub-keywords").html(b.keywords);k.find(".pub-authors").text(b.creators);CwZ('.cw-sideBarNav a[data-action="cw-citeTab"]').show();CwZ(".cw-tabNavigator .cw-citeTab").show();b.ext.description||CwZ(".pub-abs-container").hide();b.keywords||CwZ(".pub-keyword-container").hide();CwZ(".cw-citeTab").show();c=""+(b.source?b.source+", ":"");c+=b.year?b.year:"";c+=b.volume?", vol. "+b.volume+", ":"";c+=b.issue?b.issue:"";c+=b.edition?b.edition:"";c+=b.page?"pp. "+b.page:"";k.find(".pub-info").text(c)}}else window.parent.CWParser.getDetails?
a=window.parent.CWParser.getDetails():this.getIdentifier(function(a){0<a.doi.length?CWUtils.log("doi found"):0<a.arxivId.length?CWUtils.log("arxiv id found"):0<a.title.length?CWUtils.log("title id found"):CWUtils.log("doi not found")});a.title?(CwZ(".pub-title").text(a.title),a.keywords&&(a.keywords=a.keywords.clone()),a.authors?CwZ(".pub-authors").text(a.authors):CwZ(".pub-authors").hide(),a.abs?(c=a.abs,(new RegExp(/<br>/g)).test(c)?CwZ(".pub-abstract").html(c):(CwZ(".pub-abstract").css("white-space",
" pre-wrap"),CwZ(".pub-abstract").text(c))):CwZ(".pub-abs-container").hide(),a.keywords&&0!==a.keywords.length?CwZ(".pub-keywords").html(a.keywords):CwZ(".pub-keyword-container").hide(),a.journalText?CwZ(".pub-info").html(a.journalText):CwZ(".pub-info").hide(),CwZ('.cw-sideBarNav a[data-action="cw-citeTab"]').css("display",""),CwZ(".cw-tabNavigator .cw-citeTab").css("display","block")):(CwZ('.cw-sideBarNav a[data-action="cw-citeTab"]').hide(),CwZ(".cw-tabNavigator .cw-citeTab").hide())};return c}(),
CWEventTracker=function(){var c=[],a="addRelatedPub viewRelatedPub findRelatedPub viewInLibraryFromReader viewReferencedPub findReferencedPub".split(" ");return{pushEvent:function(b){if(-1===c.indexOf(b)||-1!==a.indexOf(b))-1===c.indexOf(b)&&c.push(b),CWPDFReaderConfig.isCoreMode()?CWDataCenter.postToTracker(b):CWPDFReaderConfig.readerMode!==CWPDFReaderMode.Publisher&&CWPDFReaderConfig.readerMode!==CWPDFReaderMode.Chrome||CWPDFReader.CWIFrameManager.tell("dialogEvent",{message:b,view:"mainExt"})},
hasEvent:function(a){return-1!==c.indexOf(a)},getEventsList:function(){return c},addEvent:function(a){-1===c.indexOf(a)&&c.push(a)}}}(),CWPDFTour=function(){function c(){m=CwZ(".guideTipContainer");p=setTimeout(function(){CWPDFTour.show(h.highlight)},1E3);n=setTimeout(function(){CWPDFTour.show(h.extension)},25E3)}function a(a){var c=localStorage.getItem(a)||!1,f=((new Date).getTime()-CWDataHolder.lastActivity.scroll)/1E3,g=((new Date).getTime()-CWDataHolder.lastActivity.click)/1E3;switch(a){case h.highlight:c||
CWEventTracker.hasEvent(a)||b();break;case h.addToLib:c||d();break;case h.reference:c||(5<=f&&5<=g?k():(q&&clearTimeout(q),q=setTimeout(function(){CWPDFTour.show(h.reference)},2E3)));break;case h.extension:c||CWPDFReaderConfig.readerMode!==CWPDFReaderMode.Publisher||(25<=f&&25<=g&&!m.is(":visible")&&0===CwZ("#cw-loginFrame:visible",window.parent.document).length?e():(n&&clearTimeout(n),n=setTimeout(function(){CWPDFTour.show(h.extension)},1E4)))}}function b(){if(CWPDFReaderConfig.readerMode===CWPDFReaderMode.Publisher&&
!CWEventTracker.hasEvent("annotationPDF")&&!CWDataHolder.isLogin){var a=CwZ(".tools.cw-tools"),b=f();b.addClass("TL");b.find("h4").text("Take notes on this article!");b.find("p").text("Select text, highlight with different colors and use drawing tools.");r=new Tether({element:b,target:a,attachment:"top left",targetAttachment:"bottom left"});b.fadeIn();localStorage.setItem(h.highlight,(new Date("2015-09-08")).getTime().toString());setTimeout(function(){b.fadeOut()},5E3)}}function d(){CWPDFReaderConfig.readerMode===
CWPDFReaderMode.Publisher&&(CWEventTracker.hasEvent("addlibtip")||setTimeout(function(){CwZ("#cw-pdfReaderAdd").hasClass("primary-btn-blue")&&(CwZ(".cw-atl-content").fadeIn(),CwZ("body").removeClass("cw-focus-mode"))},300),localStorage.setItem(h.addToLib,(new Date("2015-09-08")).getTime().toString()))}function k(){if(CWPDFReaderConfig.readerMode===CWPDFReaderMode.Publisher&&!CWEventTracker.hasEvent("referenceClick")&&0<CwZ("#cw-page-2 .annotLink:first").length){var a=CwZ("#cw-page-2 .annotLink:first"),
b=f();b.addClass("TL");b.find("h4").text("Clickable references");b.find("p").text("Click on any reference within the text and find that article immediately.");l(a[0])?(r=new Tether({element:b,target:a,attachment:"top left",targetAttachment:"bottom left",targetModifier:"visible",targetOffset:"0 -25px",constraints:[{to:"scrollParent"}]}),b.fadeIn(),localStorage.setItem(h.reference,(new Date("2015-09-08")).getTime().toString()),p=setTimeout(function(){b.fadeOut()},5E3)):(q&&clearTimeout(q),q=setTimeout(function(){this.show(h.reference)},
2E3))}}function e(){if(CWPDFReaderConfig.readerMode===CWPDFReaderMode.Publisher){var a=navigator.userAgent.toLowerCase();!/chrom(e|ium)/.test(a)||/edge/.test(a)||/opr/.test(a)||/maxthon/.test(a)?(CwZ(".cw-plugin-notifier .chrome-notifier").hide(),CwZ(".cw-plugin-notifier .other-notifier").show(),CwZ(".cw-plugin-notifier").addClass("show")):window.isCwZExtension||window.parent.isCwZExtension||(CwZ("head").append('<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/djdocbgipfnggcpdejicpgjcaijcdlga">'),
CwZ(".cw-plugin-notifier .chrome-notifier").show(),CwZ(".cw-plugin-notifier").addClass("show"));try{localStorage.setItem(h.extension,(new Date("2015-09-08")).getTime().toString())}catch(b){CWUtils.log(b)}CwZ(".cw-plugin-notifier .icon-close").on("click",function(){CwZ(".cw-plugin-notifier").removeClass("show");localStorage.setItem(h.extension,(new Date("2015-09-08")).getTime().toString())});CwZ('.chrome-notifier [data-action="install-chrome-extension"]').on("click",function(){CwZ(".cw-plugin-notifier").removeClass("show");
localStorage.setItem(h.extension,(new Date("2015-09-08")).getTime().toString())})}}function f(){r&&r.destroy();m.removeClass("TL TM TR RT RM RB BR BM BL LB LM LT");m.on("click",g);return m}function l(a){var b=a.getBoundingClientRect().top;a=a.getBoundingClientRect().bottom;return 0<=b&&a<=window.innerHeight}function g(){p&&clearTimeout(p);CwZ(this).fadeOut()}var h={highlight:"HighlightTour",addToLib:"AddToLibTour",reference:"ReferenceTour",extension:"ExtTour"},m,r,p,q,n;return{show:function(b){a(b)},
hideAll:function(){m.fadeOut()},isElementInView:function(a){return l(a)},init:function(){c()}}}(),performanceAnalyzer=function(){return{test:function(c){try{CWUtils.log("*** STARTING PERFORMANCE TEST ***");var a=Array.prototype.slice.call(arguments,1);return function(){for(var b=a.concat(Array.prototype.slice.call(arguments)),k=performance.now(),e=0;1E3>e;e++)c.apply(this,b);b=performance.now();CWUtils.log("Processed in "+(b-k)+"ms");CWUtils.log("*** PERFORMANCE TEST FINISH ***")}}catch(b){CWUtils.log("*** TEST FAILED ***")}}}}();
