var CWDrawMode;(function(c){c[c.Drag=0]="Drag";c[c.Freehand=1]="Freehand";c[c.Line=2]="Line";c[c.Rectangle=3]="Rectangle";c[c.Highlight=4]="Highlight";c[c.Ellipse=5]="Ellipse";c[c.Arrow=6]="Arrow";c[c.Eraser=7]="Eraser";c[c.Comment=8]="Comment";c[c.TextSelection=9]="TextSelection"})(CWDrawMode||(CWDrawMode={}));var CWDrawEvent;(function(c){c[c.Click=0]="Click";c[c.TouchStart=1]="TouchStart";c[c.TouchEnd=2]="TouchEnd";c[c.TouchMove=3]="TouchMove"})(CWDrawEvent||(CWDrawEvent={}));
var CWPoint=function(){return function(c,a){"undefined"===typeof c&&(c=null);"undefined"===typeof a&&(a=null);this.x=parseInt(c,10);this.y=parseInt(a,10)}}(),CWAnnotateClass=function(){function c(){this.oldMousePos=[null,null];this.newIds=(new Date).getTime();this.pagesSVG=[];this.hashSVG={};this.hashComment={};this.mouseDn=0;this.mouseMovePage=this.mouseDownPage=this.mousemovestartY=this.mousemovestartX=this.newMousePosY=this.newMousePosX=this.oldMousePosY=this.oldMousePosX=-1;this.clipboardText=
""}c.prototype.init=function(a){a=a?a.jqElement:CwZ(document);a.find(".cw-textLayer").off("click mousemove mousedown mouseup");a.find(".cw-textLayer").on("click mousemove mousedown mouseup",function(a){a.stopImmediatePropagation();CWDataHolder.lastActivity.click=(new Date).getTime();if(CWDraw.drawMode===CWDrawMode.TextSelection){CwZ(".cw-body").removeClass("no-select");var b=CwZ(".cw-text-tip"),e=0,d=0;CWPageManager.scrollPosition&&(e=CWPageManager.scrollPosition.y,d=CWPageManager.scrollPosition.x);
switch(a.type){case "mousedown":CWPDFTour.hideAll();CwZ(".cw-textLayer div").css("position","");CwZ(".cw-text-tip-edit").hide();CWDataHolder.textLayerMPOS={x:a.pageX,y:a.pageY};CwZ("#floatBarCont").addClass("disable");CWAnnotate.oldMousePosX=a.pageX-20+d;CWAnnotate.oldMousePosY=a.pageY-100+e;CWAnnotate.mouseDn=1;b.hide();(a=window.getSelection?window.getSelection():document.selection)&&(a.removeAllRanges?a.removeAllRanges():a.empty&&a.empty());break;case "mouseup":if(""!==window.getSelection().toString()){CWAnnotate.mouseDn=
0;if(-1===CWAnnotate.newMousePosX&&-1===CWAnnotate.newMousePosY&&(e=CwZ("div.cw-textLayer div"),3!==a.which))for(d=0;d<e.length;d++)CwZ(e[d]).css("background-color","rgba(0, 0, 0, 0.0)");CWAnnotate.getSelectedText(a);e=CwZ(this).closest(".cw-page").data("page");CWDraw.selectionPage=parseInt(e,10);CWDraw.draw=CWAnnotate.pagesSVG[CWDraw.selectionPage];b.show();e=a.pageX-b.outerWidth()/2;b.css("top",a.pageY-b.height()-20);b.css("left",e);a=CwZ(".color-pick").width();b=CwZ(".cw-text-tip").width();d=CwZ("header").height();
e+b+a>CwZ(window).width()?CwZ(".cw-text-tip").addClass("tip-left"):CwZ(".cw-text-tip").removeClass("tip-left");CwZ(".cw-text-tip").offset().top<d?CwZ(".cw-text-tip").addClass("tip-down"):CwZ(".cw-text-tip").removeClass("tip-down");CWAnnotate.newMousePosX=-1;CWAnnotate.newMousePosY=-1;CWAnnotate.oldMousePosX=-1;CWAnnotate.oldMousePosY=-1}break;case "mousemove":CWPDFReader.calculateTooltip(a);b=CwZ(this).closest(".cw-page").data("page");parseInt(b,10);if("Caret"===window.getSelection().type&&1===CWAnnotate.mouseDn){CWAnnotate.newMousePosX=
a.pageX-20+d;CWAnnotate.newMousePosY=a.pageY-100+e;break}break;case "click":CwZ(".cw-atl-content").hide(),CwZ(".cw-download-content").hide(),CwZ(".cw-download-content").hide(),b=CWDataHolder.textLayerMPOS,b.x===a.pageX&&b.y===a.pageY?(CwZ(".cw-annotationCanvas").css("z-index",1),CwZ(".cw-textLayer").css("z-index",0),b=document.elementFromPoint(a.clientX,a.clientY),CwZ(".cw-annotationCanvas").css("z-index",""),CwZ(".cw-textLayer").css("z-index",""),CWPDFReader.showAnnotText(b)):CwZ(".cw-text-tip-edit").is(":visible")&&
CwZ(".cw-text-tip-edit").hide(),"annotLink"!==a.target.className&&CwZ(".referenceHTMLTopDiv").remove()}}});CwZ("#btnLogoutCancel").on("click",function(){CwZ("#CWLogoutDialog").hide()});CwZ("#btnServerCancel").on("click",function(){CwZ("#CWServerNotFound").hide()});var b=window.isCwMobile.any()?"click touchmove touchend touchstart":"click mousemove mousedown mouseup mouseleave";a.find(".cw-annotationCanvas").off(b).on(b,function(a){function b(){CwZ(".cw-atl-content").hide();CwZ(".cw-download-content").hide();
CWDataHolder.canvasMStates.shapeMoved?CWDataHolder.canvasMStates.shapeMoved=!1:CWPDFReader.showAnnotText(a.target);"annotLink"!==a.target.className&&CwZ(".referenceHTMLTopDiv").remove();CWAnnotate.oldMousePos=[a.pageX,a.pageY];if(CWDraw.drawMode===CWDrawMode.Comment&&!CWDataHolder.canvasMStates.onShape){CWDraw.updatePoint(l,CWDrawEvent.Click);if(null===CWDraw.activeShape){var d=CWDrawFactory.getInstance();d.ID=CWAnnotate.generateID(d,g);CWDraw.activeShape=d;CWDataHolder.currentComment=d;CWDraw.activeShape.addPoint(CWDraw.tsPoint);
CWDraw.activeShape.page=g;CWCommentManager.addComment(CWDraw.activeShape)}else CWDraw.activeShape.addPoint(CWDraw.tePoint);null!==CWDraw.activeShape&&(CWDraw.drawShape(CWDraw.activeShape),CWDraw.activeSVG&&(d=CWDraw.activeSVG.node.id,CWAnnotate.hashSVG[d]=CWDraw.activeShape.ID,CWAnnotate.hashComment[CWDraw.activeShape.ID]=d,CWDraw.activeShape=null,CWDraw.activeSVG=null,CWPDFReader.addNote(null,!1)))}CWDraw.commentDragOn=0}function e(){"touchmove"===a.type&&(CWDataHolder.lastTouch=a.originalEvent.touches[0],
CWDraw.drawMode!==CWDrawMode.Drag&&a.preventDefault());CWDataHolder.canvasMStates.mMove=!0;CWAnnotate.mouseMovePage=g;CWPDFReader.calculateTooltip(a);if(CWDraw.mouseEnabled&&CWAnnotate.mouseDownPage===CWAnnotate.mouseMovePage)if(1!==CWDraw.dragSVG||CWDraw.drawMode!==CWDrawMode.Drag||(!CWPDFReaderConfig.checkReaderMode("drive")||CWDataCenter.isReadOnly)&&CWPDFReaderConfig.checkReaderMode("drive")){CWAnnotate.newMousePosX=a.pageX;CWAnnotate.newMousePosY=a.pageY;if(CWDraw.drawMode!==CWDrawMode.Drag&&
CWDraw.drawMode!==CWDrawMode.Eraser&&CWDraw.drawMode!==CWDrawMode.Comment){"annotLink"!==a.target.className&&CWDraw.updatePoint(l,CWDrawEvent.TouchMove);if(null===CWDraw.activeShape){if(CWDraw.tsPoint.x!==CWDraw.tePoint.x||CWDraw.tsPoint.y!==CWDraw.tePoint.y){var b=CWDrawFactory.getInstance();b.ID=CWAnnotate.generateID(b,g);CWDraw.activeShape=b;CWDraw.activeShape.lineWidth=CWDraw.lineWidth;CWDraw.activeShape.color=CWDraw.drawMode===CWDrawMode.Highlight?CWDraw.colorHL:CWDraw.color;CWDraw.activeShape.addPoint(CWDraw.tsPoint);
CWDraw.activeShape.page=g;CWDraw.activeShape.updatePoint(CWDraw.tePoint)}}else CWDraw.activeShape.updatePoint(CWDraw.tePoint);null!==CWDraw.activeShape&&(CWDraw.drawShape(CWDraw.activeShape),CWDraw.activeSVG&&(b=CWDraw.activeSVG.node.id,CWAnnotate.hashSVG[b]=CWDraw.activeShape.ID,CWAnnotate.hashComment[CWDraw.activeShape.ID]=b))}if(CWDraw.drawMode===CWDrawMode.Drag){var b=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),d=0<navigator.userAgent.indexOf("MSIE"),b=b||d?"cw-content cw-pointer-grab-IE":
"cw-content cw-pointer-grab";CwZ("#cw-pdfReader .cw-content").attr("class",b);b=[a.pageX,a.pageY];CWAnnotate.oldMousePos[0]&&CWUtils.moveScrollbarToXY(".cw-pageContent",b[0]-CWAnnotate.oldMousePos[0],b[1]-CWAnnotate.oldMousePos[1]);CWAnnotate.oldMousePos=b}}else{CwZ(document).off("contextmenu").on("contextmenu",function(a){a.preventDefault();c();a.stopImmediatePropagation();CwZ(document).off("contextmenu");return!1});-1===CWAnnotate.mousemovestartX&&-1===CWAnnotate.mousemovestartY&&(CWAnnotate.mousemovestartX=
a.pageX/(CWPageManager.getZoomLevel()*CWPageManager.scale/100),CWAnnotate.mousemovestartY=a.pageY/(CWPageManager.getZoomLevel()*CWPageManager.scale/100));b=a.pageX/(CWPageManager.getZoomLevel()*CWPageManager.scale/100);d=a.pageY/(CWPageManager.getZoomLevel()*CWPageManager.scale/100);CWDraw.diffX=b-CWAnnotate.mousemovestartX;CWDraw.diffY=d-CWAnnotate.mousemovestartY;CWDraw.diffX=-1!==CWDraw.diffX?2*CWDraw.diffX:CWDraw.diffX;CWDraw.diffY=-1!==CWDraw.diffY?2*CWDraw.diffY:CWDraw.diffY;if(-1!==CWDraw.oldRectPosX&&
-1!==CWDraw.oldRectPosY){if(0!==CWDraw.diffX||0!==CWDraw.diffY)CwZ("#"+CWDraw.currentShapeID).attr("x",CWDraw.oldRectPosX+CWDraw.diffX),CwZ("#"+CWDraw.currentShapeID).attr("y",CWDraw.oldRectPosY+CWDraw.diffY)}else if(-1!==CWDraw.oldCirPosX&&-1!==CWDraw.oldCirPosY){if(0!==CWDraw.diffX||0!==CWDraw.diffY)CwZ("#"+CWDraw.currentShapeID).attr("cx",CWDraw.oldCirPosX+CWDraw.diffX),CwZ("#"+CWDraw.currentShapeID).attr("cy",CWDraw.oldCirPosY+CWDraw.diffY)}else if(-1!==CWDraw.oldLineX1&&-1!==CWDraw.oldLineY1&&
-1!==CWDraw.oldLineX2&&-1!==CWDraw.oldLineY2){if(0!==CWDraw.diffX||0!==CWDraw.diffY)CwZ("#"+CWDraw.currentShapeID).attr("x1",CWDraw.oldLineX1+CWDraw.diffX),CwZ("#"+CWDraw.currentShapeID).attr("y1",CWDraw.oldLineY1+CWDraw.diffY),CwZ("#"+CWDraw.currentShapeID).attr("x2",CWDraw.oldLineX2+CWDraw.diffX),CwZ("#"+CWDraw.currentShapeID).attr("y2",CWDraw.oldLineY2+CWDraw.diffY)}else if(-1!==CWDraw.oldCommentX&&-1!==CWDraw.oldCommentY){if(0!==CWDraw.diffX||0!==CWDraw.diffY)b=""+("m"+(CWDraw.oldCommentX+CWDraw.diffX)+
","+(CWDraw.oldCommentY+CWDraw.diffY)),b+="l0,-6l-3,0c-1.5,0 -3,-1.5 -3,-3l0,-5c0,-1.5 1.5,-3 3,-3l14,0c1.5,0 3,1.5 3,3l0,5c0,1.5 -1.5,3 -3,3l-7,0l-4,6z",CwZ("#"+CWDraw.currentShapeID).attr("d",b)}else-1===CWDraw.oldArrowp1x||-1===CWDraw.oldArrowp1y||0===CWDraw.diffX&&0===CWDraw.diffY||(b="M"+(CWDraw.oldArrowp1x+CWDraw.diffX)+","+(CWDraw.oldArrowp1y+CWDraw.diffY),b+="L"+(CWDraw.oldArrowp2x+CWDraw.diffX)+","+(CWDraw.oldArrowp2y+CWDraw.diffY),b+="M"+(CWDraw.oldArrowp2x+CWDraw.diffX)+","+(CWDraw.oldArrowp2y+
CWDraw.diffY),b+="L"+(CWDraw.oldArrowaLx+CWDraw.diffX)+","+(CWDraw.oldArrowaLy+CWDraw.diffY),b+="M"+(CWDraw.oldArrowp2x+CWDraw.diffX)+","+(CWDraw.oldArrowp2y+CWDraw.diffY),b+="L"+(CWDraw.oldArrowaRx+CWDraw.diffX)+","+(CWDraw.oldArrowaRy+CWDraw.diffY),CwZ("#"+CWDraw.currentShapeID).attr("d",b));if(0!==CWDraw.diffX||0!==CWDraw.diffY)CWDataHolder.canvasMStates.shapeMoved=!0}}function d(){CWPDFTour.hideAll();CwZ(".cw-text-tip-edit").hide();CWDataHolder.canvasMStates.onShape&&!CWDataHolder.canvasMStates.mDown&&
(CWDataHolder.oldDrawMode=CWDraw.drawMode,CWPDFReader.handTool(),CWPDFReader.autoSyncTriggerTimer&&(clearTimeout(CWPDFReader.autoSyncTriggerTimer),CWDataHolder.wasSyncing=!0));CWDataHolder.canvasMStates.mDown=!0;CwZ("#floatBarCont").addClass("disable");CWAnnotate.mouseDownPage=g;0<CwZ(".cw-text-tip").length&&CwZ(".cw-text-tip").show()&&CwZ(".cw-text-tip").hide();if(CWDraw.drawMode===CWDrawMode.Drag){var b=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),d=0<navigator.userAgent.indexOf("MSIE"),
b=b||d?"cw-content cw-pointer-grab-IE":"cw-content cw-pointer-grab";CwZ("#cw-pdfReader .cw-content").attr("class",b);CwZ(".cw-body").addClass("no-select");document.getSelection().removeAllRanges()}CWAnnotate.oldMousePos=[a.pageX,a.pageY];CWDraw.draw=CWAnnotate.pagesSVG[g];if(1===a.which||"touchstart"===a.type)CWDraw.mouseEnabled=!0;CWDraw.updatePoint(l,CWDrawEvent.TouchStart)}function c(){CWDataHolder.canvasMStates.mDown=!1;CWDataHolder.canvasMStates.onShape&&CWPDFReader.toggleTool();CWDataHolder.wasSyncing&&
(CWDataHolder.wasSyncing=!1,CWPDFReader.doDelayedSync());CwZ("#floatBarCont").removeClass("disable");var a=CWCommentManager.annotationArr,b=0;if(-1!==CWDraw.oldRectPosX&&-1!==CWDraw.oldRectPosY){if(0!==CWDraw.diffX||0!==CWDraw.diffY)for(b=0;b<a.length;b++)if(a[b].ID===CWDraw.activeShapeID){CWCommentManager.annotationArr[b].points[0].x=CWDraw.oldRectPosX+CWDraw.diffX;CWCommentManager.annotationArr[b].points[0].y=CWDraw.oldRectPosY+CWDraw.diffY;CWCommentManager.annotationArr[b].ts=(new Date).getTime();
CwZ(document).trigger("cwAnnotationsUpdated");break}}else if(-1!==CWDraw.oldCirPosX&&-1!==CWDraw.oldCirPosY){if(0!==CWDraw.diffX||0!==CWDraw.diffY)for(b=0;b<a.length;b++)if(a[b].ID===CWDraw.activeShapeID){CWCommentManager.annotationArr[b].points[0].x=CWDraw.oldCirPosX+CWDraw.diffX-parseInt(CwZ("#"+CWDraw.currentShapeID).attr("rx"),10);CWCommentManager.annotationArr[b].points[0].y=CWDraw.oldCirPosY+CWDraw.diffY-parseInt(CwZ("#"+CWDraw.currentShapeID).attr("ry"),10);CWCommentManager.annotationArr[b].ts=
(new Date).getTime();CwZ(document).trigger("cwAnnotationsUpdated");break}}else if(-1!==CWDraw.oldLineX1&&-1!==CWDraw.oldLineY1&&-1!==CWDraw.oldLineX2&&-1!==CWDraw.oldLineY2){if(0!==CWDraw.diffX||0!==CWDraw.diffY)for(b=0;b<a.length;b++)if(a[b].ID===CWDraw.activeShapeID){CWCommentManager.annotationArr[b].points[0].x=CWDraw.oldLineX1+CWDraw.diffX;CWCommentManager.annotationArr[b].points[0].y=CWDraw.oldLineY1+CWDraw.diffY;CWCommentManager.annotationArr[b].ts=(new Date).getTime();CwZ(document).trigger("cwAnnotationsUpdated");
break}}else if(-1!==CWDraw.oldCommentX&&-1!==CWDraw.oldCommentY){if(0!==CWDraw.diffX||0!==CWDraw.diffY)for(b=0;b<a.length;b++)if(a[b].ID===CWDraw.activeShapeID){CWCommentManager.annotationArr[b].point.x=CWDraw.oldCommentX+CWDraw.diffX;CWCommentManager.annotationArr[b].point.y=CWDraw.oldCommentY+CWDraw.diffY;CWCommentManager.annotationArr[b].ts=(new Date).getTime();CwZ(document).trigger("cwAnnotationsUpdated");break}}else if(-1!==CWDraw.oldArrowp1x&&-1!==CWDraw.oldArrowp1y&&(0!==CWDraw.diffX||0!==
CWDraw.diffY))for(b=0;b<a.length;b++)if(a[b].ID===CWDraw.activeShapeID){CWCommentManager.annotationArr[b].points[0].x=CWDraw.oldArrowp1x+CWDraw.diffX;CWCommentManager.annotationArr[b].points[0].y=CWDraw.oldArrowp1y+CWDraw.diffY;CWCommentManager.annotationArr[b].ts=(new Date).getTime();CwZ(document).trigger("cwAnnotationsUpdated");break}CWDraw.dragSVG=-1;CWDraw.oldRectPosX=-1;CWDraw.oldRectPosY=-1;CWDraw.oldCirPosX=-1;CWDraw.oldCirPosY=-1;CWDraw.oldLineX1=-1;CWDraw.oldLineY1=-1;CWDraw.oldLineX2=-1;
CWDraw.oldLineY2=-1;CWDraw.oldCommentX=-1;CWDraw.oldCommentY=-1;CWDraw.oldArrowaLx=-1;CWDraw.oldArrowaLy=-1;CWDraw.oldArrowaRx=-1;CWDraw.oldArrowaRy=-1;CWDraw.oldArrowp1x=-1;CWDraw.oldArrowp1y=-1;CWDraw.oldArrowp2x=-1;CWDraw.oldArrowp2y=-1;CWAnnotate.mousemovestartX=-1;CWAnnotate.mousemovestartY=-1;CWAnnotate.mouseDownPage=-1;CWAnnotate.mouseMovePage=-1;CWDraw.diffX=0;CWDraw.diffY=0;CWAnnotate.oldMousePos=[null,null];CWDraw.drawMode===CWDrawMode.Drag&&(a=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),
b=0<navigator.userAgent.indexOf("MSIE"),a=a||b?"cw-content cw-pointer-hand-IE":"cw-content cw-pointer-hand",CwZ("#cw-pdfReader .cw-content").attr("class",a));CWDraw.mouseEnabled=!1;try{CWDraw.updatePoint(l,CWDrawEvent.TouchEnd),null!==CWDraw.activeShape&&(CWDraw.activeShape.updatePoint(CWDraw.tePoint),CWCommentManager.addComment(CWDraw.activeShape))}catch(f){CWPDFReaderConfig.isCoreMode()?PDFRaven.captureException(f.stack):CwZ(document).trigger("cwExcToSentry",f)}CWDraw.activeShape=null;CWDraw.activeSVG=
null}a.stopImmediatePropagation();window.isCwMobile.any()&&("touchend"===a.type?(a.pageX=CWDataHolder.lastTouch.pageX*mobileConfig.SCALE,a.pageY=CWDataHolder.lastTouch.pageY*mobileConfig.SCALE):"click"!==a.type?(a.pageX=a.originalEvent.touches[0].pageX*mobileConfig.SCALE,a.pageY=a.originalEvent.touches[0].pageY*mobileConfig.SCALE):"click"===a.type&&CWDraw.drawMode===CWDrawMode.Comment&&(a.pageX=CWDataHolder.lastTouch.pageX*mobileConfig.SCALE,a.pageY=CWDataHolder.lastTouch.pageY*mobileConfig.SCALE));
CWDataHolder.lastActivity.click=(new Date).getTime();CWDraw.activeCanvas=this;var g=CwZ(this).closest(".cw-page").data("page"),g=parseInt(g,10),l=CWAnnotate.getPoint(a,this);switch(a.type){case "click":1===(a.which||a.button)&&b();break;case "touchstart":CWDataHolder.lastTouch=a.originalEvent.touches[0];d();break;case "mousedown":3===(a.which||a.button)&&c();1===(a.which||a.button)&&d();break;case "touchend":c();break;case "mouseup":1===(a.which||a.button)&&c();break;case "mousemove":case "touchmove":e()}})};
c.prototype.getPoint=function(a,b){var f,h,c=CWPageManager.getZoomLevel()*CWPageManager.scale/100;f=a.pageX-CwZ(b).offset().left;h=a.pageY-CwZ(b).offset().top;window.isCwMobile.any()&&(h=a.pageY-(b.parentElement.offsetTop+54*mobileConfig.SCALE),f=a.pageX-b.parentElement.offsetLeft- -15);return new CWPoint(f/c,h/c)};c.prototype.setSVG=function(a){var b=a.getPageNumber();CWAnnotate.pagesSVG[b]=a.svg;CWAnnotate.drawAll(b)};c.prototype.drawAll=function(a){var b=CWCommentManager.getCommentsByPage(a);CWDraw.draw=
CWAnnotate.pagesSVG[a];for(a=0;a<b.length;a++){CWDraw.drawShape(b[a]);if(CWDraw.activeSVG){var f=CWDraw.activeSVG.node.id;try{CwZ(CwZ("#"+f)[0].parentNode).is("g")&&(f=CwZ(CwZ("#"+f)[0].parentNode)[0].id)}catch(c){CWUtils.log(c)}CWUtils.log("SVG ID:"+f);CWAnnotate.hashSVG[f]=b[a].ID;CWAnnotate.hashComment[b[a].ID]=f}CWDraw.activeSVG=null}};c.prototype.drawShape=function(a){if(CWAnnotate.hashComment[a.ID])CWDraw.updateShapeComment(a.ID,a.cmt,a);else{CWDraw.draw=CWAnnotate.pagesSVG[a.page];CWDraw.activeSVG=
null;CWDraw.drawShape(a);if(CWDraw.activeSVG){var b=CWDraw.activeSVG.node.id;try{CwZ(CwZ("#"+b)[0].parentNode).is("g")&&(b=CwZ(CwZ("#"+b)[0].parentNode)[0].id)}catch(f){CWUtils.log(f)}CWUtils.log("SVG ID:"+b);CWAnnotate.hashSVG[b]=a.ID;CWAnnotate.hashComment[a.ID]=b}CWDraw.activeSVG=null}};c.prototype.generateID=function(a,b){var f=null,f=a.constructor===CWComment?"c"+b+"t"+CWAnnotate.newIds:"s"+b+"t"+CWAnnotate.newIds;CWAnnotate.newIds++;return f};c.prototype.getSelectedText=function(a){var b="";
if("Range"===window.getSelection().type)b=window.getSelection().toString();else{var f=CwZ("div.cw-textLayer div");if(3!==a.which)for(a=0;a<f.length;a++)"rgba(84, 132, 237, 0.4)"===CwZ(f[a]).css("background-color")&&(b+=CwZ(f[a]).html())}this.clipboardText=b};return c}(),CWAnnotate=new CWAnnotateClass,CWDrawClass=function(){function c(){this.cPoint=new CWPoint;this.tsPoint=new CWPoint;this.tePoint=new CWPoint;this.currentLayer=null;this.drawMode=CWDrawMode.Drag;this.activeShape=this.activeCanvas=null;
this.delBtnHideTimeout=700;this.draw=this.activeSVG=this.delBtnLeaveTimer=this.delBtnTimer=null;this.colorHL=this.color="#FFFA45";this.lineWidth=3;this.totalObj=0;this.mouseEnabled=!1;this.selectionPage=0;this.oldLineY2=this.oldLineX2=this.oldLineY1=this.oldLineX1=this.oldCommentY=this.oldCommentX=this.oldCirPosY=this.oldCirPosX=this.oldRectPosY=this.oldRectPosX=-1;this.commentDragOn=0;this.oldArrowaRy=this.oldArrowaRx=this.oldArrowaLy=this.oldArrowaLx=this.oldArrowp2y=this.oldArrowp2x=this.oldArrowp1y=
this.oldArrowp1x=-1;this.diffY=this.diffX=0;this.currentShapeID=this.dragSVG=-1;this.delBtn=this.itemToDel=null;this.activeShapeID=this.activeSVGID=-1}c.prototype.updatePoint=function(a,b){switch(b){case CWDrawEvent.Click:CWDraw.cPoint=a;CWDraw.tsPoint=a;CWDraw.tePoint=a;break;case CWDrawEvent.TouchStart:CWDraw.tsPoint=a;CWDraw.tePoint=a;break;case CWDrawEvent.TouchEnd:CWDraw.tePoint=a;break;case CWDrawEvent.TouchMove:CWDraw.cPoint=a,CWDraw.tePoint=a}};c.prototype.drawShape=function(a){if(void 0!==
CWDraw.draw)if(a instanceof CWLine)null===CWDraw.activeSVG?(a=CWDraw.draw.line(2*a.points[0].x,2*a.points[0].y,2*a.points[1].x,2*a.points[1].y).attr({stroke:a.color,"stroke-linecap":"round","stroke-width":a.lineWidth,"stroke-opacity":.8}),a.on("mousedown",function(){CWDraw.currentShapeID=this.id;CWDraw.oldLineX1=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("x1"),10);CWDraw.oldLineY1=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("y1"),10);CWDraw.oldLineX2=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("x2"),
10);CWDraw.oldLineY2=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("y2"),10);CWDraw.dragSVG=1}),a.click(CWDraw.shapeClick),a.mouseenter(CWDraw.shapeMouseEnter),a.mouseleave(CWDraw.shapeMouseLeave),CWDraw.activeSVG=a):CWDraw.activeSVG.plot(2*a.points[0].x,2*a.points[0].y,2*a.points[1].x,2*a.points[1].y);else if(a instanceof CWArrow){var b=a.points[0],f=a.points[1],c=Math.atan2(f.y-b.y,f.x-b.x),e=new CWPoint(2*f.x-10*Math.cos(c-Math.PI/6),2*f.y-10*Math.sin(c-Math.PI/6)),c=new CWPoint(2*f.x-10*Math.cos(c+
Math.PI/6),2*f.y-10*Math.sin(c+Math.PI/6)),b="M"+2*b.x+","+2*b.y,b=b+("L"+2*f.x+","+2*f.y),b=b+("M"+2*f.x+","+2*f.y),b=b+("L"+e.x+","+e.y),b=b+("M"+2*f.x+","+2*f.y),b=b+("L"+c.x+","+c.y);null===CWDraw.activeSVG?(a=CWDraw.draw.path(b,!0).attr({stroke:a.color,"stroke-width":a.lineWidth,"stroke-linecap":"round","fill-opacity":0,"stroke-opacity":.8}),a.click(CWDraw.shapeClick),a.on("mousedown",function(){var a=CwZ("#"+this.id).attr("d").split(",");CWDraw.oldArrowp1x=parseInt(a[0].replace("M",""),10);
CWDraw.oldArrowp1y=parseInt(a[1].split("L")[0],10);CWDraw.oldArrowp2x=parseInt(a[1].split("L")[1],10);CWDraw.oldArrowp2y=parseInt(a[2].split("M")[0],10);CWDraw.oldArrowaLx=parseInt(a[3].split("L")[1],10);CWDraw.oldArrowaLy=parseInt(a[4].split("M")[0],10);CWDraw.oldArrowaRx=parseInt(a[5].split("L")[1],10);CWDraw.oldArrowaRy=parseInt(a[6],10);CWDraw.dragSVG=1;CWDraw.currentShapeID=this.id}),a.mouseenter(CWDraw.shapeMouseEnter),a.mouseleave(CWDraw.shapeMouseLeave),CWDraw.activeSVG=a):CWDraw.activeSVG.plot(b)}else if(a instanceof
CWHighlight){var d=CWDraw.getWidthHeight(a.points[0],a.points[1]),f=CWDraw.getXY(a.points[0],a.points[1]),b=navigator.userAgent,b=!!document.documentMode||0<b.indexOf("Edge"),e=1,c="CSS"in window&&"supports"in window.CSS&&window.CSS.supports("mix-blend-mode","inherit");if(b||!c)e=.5;null===CWDraw.activeSVG?(b=CWDraw.draw.rect(d.x,d.y).attr({fill:a.color,"fill-opacity":e}),b.click(CWDraw.shapeClick),b.on("mousedown",function(){CWDraw.currentShapeID=this.id;CWDraw.oldRectPosX=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("x"),
10);CWDraw.oldRectPosY=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("y"),10);CWDraw.dragSVG=1}),b.mouseenter(CWDraw.shapeMouseEnter),b.mouseleave(CWDraw.shapeMouseLeave),b.move(f.x,f.y),CWDraw.activeSVG=b):(CWDraw.activeSVG.move(f.x,f.y),CWDraw.activeSVG.size(d.x,d.y))}else if(a instanceof CWRectangle)d=CWDraw.getWidthHeight(a.points[0],a.points[1]),f=CWDraw.getXY(a.points[0],a.points[1]),null===CWDraw.activeSVG?(b=CWDraw.draw.rect(d.x,d.y).attr({stroke:a.color,"stroke-width":a.lineWidth,"fill-opacity":0,
"stroke-opacity":.8}),b.on("mousedown",function(a){CWDraw.currentShapeID=this.id;CWDraw.oldRectPosX=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("x"),10);CWDraw.oldRectPosY=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("y"),10);CWDraw.dragSVG=1}),b.click(CWDraw.shapeClick),b.mouseenter(CWDraw.shapeMouseEnter),b.mouseleave(CWDraw.shapeMouseLeave),b.move(f.x,f.y),CWDraw.activeSVG=b):(CWDraw.activeSVG.move(f.x,f.y),CWDraw.activeSVG.size(d.x,d.y));else if(a instanceof CWEllipse)d=CWDraw.getWidthHeight(a.points[0],
a.points[1]),f=CWDraw.getXY(a.points[0],a.points[1]),null===CWDraw.activeSVG?(b=CWDraw.draw.ellipse(d.x,d.y).attr({stroke:a.color,"stroke-width":a.lineWidth,"fill-opacity":0,"stroke-opacity":.8}),b.on("mousedown",function(a){CWDraw.currentShapeID=this.id;CWDraw.oldCirPosX=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("cx"),10);CWDraw.oldCirPosY=parseInt(CwZ("#"+CWDraw.currentShapeID).attr("cy"),10);CWDraw.dragSVG=1}),b.click(CWDraw.shapeClick),b.mouseenter(CWDraw.shapeMouseEnter),b.mouseleave(CWDraw.shapeMouseLeave),
b.move(f.x,f.y),CWDraw.activeSVG=b):(CWDraw.activeSVG.move(f.x,f.y),CWDraw.activeSVG.size(d.x,d.y));else if(a instanceof CWSelectionHL){if(null==CWDraw.activeSVG||void 0===CWDraw.activeSVG){d=CWDraw.draw.group();b=void 0;for(f=0;f<a.rects.length;f++){var k=a.rects[f],b=navigator.userAgent,b=!!document.documentMode||0<b.indexOf("Edge"),e=1,c="CSS"in window&&"supports"in window.CSS&&window.CSS.supports("mix-blend-mode","inherit");if(b||!c)e=.5;b=CWDraw.draw.rect(k.w,k.h).attr({fill:a.color,"fill-opacity":e});
b.move(k.x,k.y);d.add(b)}d.click(CWDraw.shapeClick);d.mouseenter(CWDraw.shapeMouseEnter);d.mouseleave(CWDraw.shapeMouseLeave);CWDraw.activeSVG=b}}else if(a instanceof CWFreehand){b="";e=!0;for(f=0;f<a.points.length;f++)c=a.points[f],e?(b+="M"+2*c.x+","+2*c.y,e=!1):-1===c.x&&-1===c.y?e=!0:b+="L"+2*c.x+","+2*c.y;null===CWDraw.activeSVG?(a=CWDraw.draw.path(b,!0).attr({stroke:a.color,"stroke-width":a.lineWidth,"stroke-linecap":"round","stroke-linejoin":"round","fill-opacity":0,"stroke-opacity":.8}),a.on("mousedown",
function(a){CWDraw.currentShapeID=this.id;CWDraw.dragSVG=1;CwZ("#"+this.id).attr("d").split(",")}),a.click(CWDraw.shapeClick),CWDraw.activeSVG=a):CWDraw.activeSVG.plot(b)}else a instanceof CWComment&&(b=""+("m"+2*a.point.x+","+2*a.point.y),b+="l0,-6l-3,0c-1.5,0 -3,-1.5 -3,-3l0,-5c0,-1.5 1.5,-3 3,-3l14,0c1.5,0 3,1.5 3,3l0,5c0,1.5 -1.5,3 -3,3l-7,0l-4,6z",null===CWDraw.activeSVG?(a=CWDraw.draw.path(b,!0).attr({stroke:"#be964b","stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-opacity":.8,
fill:"#febd31","fill-opacity":.8,position:"absolute"}),a.click(CWDraw.shapeClick),a.mouseenter(CWDraw.shapeMouseEnter),a.mouseleave(CWDraw.shapeMouseLeave),a.off("mousedown"),a.on("mousedown",function(a){switch(a.type){case "mousedown":if(CWDraw.drawMode!==CWDrawMode.Eraser&&(a=this.id,a.replace("path#",""),""!==CWAnnotate.hashSVG[a])){CWDraw.currentShapeID=a;CWDraw.dragSVG=1;var b=[],b=CwZ("#"+a).attr("d").split(",");CWDraw.oldCommentX=parseInt(b[0].replace("m",""),10);CWDraw.oldCommentY=parseInt(b[1],
10);CWDraw.commentDragOn=1}break;case "mouseup":CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-comment")}}),CWDraw.activeSVG=a):CWDraw.activeSVG.plot(b))};c.prototype.shapeClick=function(){CWCommentManager.commentSideBar.selectLiById(CWAnnotate.hashSVG[this.node.id])};c.prototype.shapeMouseEnter=function(a,b,f){if(!CWDataHolder.canvasMStates.mDown){CWDataHolder.canvasMStates.onShape=!0;CwZ(a.target).css("cursor","pointer");(CwZ(".cw-content").hasClass("cw-pointer-hand")||CwZ(".cw-content").hasClass("cw-pointer-hand-IE"))&&
CWDraw.drawMode!==CWDrawMode.Freehand&&CwZ("#cw-page-"+CWPageManager.currentPage).css("cursor","all-scroll");b instanceof MouseEvent||void 0===b&&!a.node?b=this:void 0===b&&a.node&&(b=a);var c=b.node.id,e=CWAnnotate.hashSVG[c];CWDraw.activeSVGID=c;CWDraw.activeShapeID=e;CWDraw.drawMode===CWDrawMode.Comment&&c.indexOf("Path");CWCommentManager.commentSideBar.setHoverOnLiById(e,!0);CWDraw.itemToDel&&CWDraw.itemToDel!==b&&(CWCommentManager.commentSideBar.setHoverOnLiById(CWAnnotate.hashSVG[CWDraw.itemToDel.node.id],
!1),CWDraw.itemToDel.unfilter());if("g"===b.type)for(c=b.children(),e=0;e<c.length;e++)b=c[e],b.filter(function(a){var b=a.offset(0,0)["in"](a.sourceAlpha).gaussianBlur("2");a.blend(a.source,b)});else b.filter(function(a){a.attr("filterUnits","userSpaceOnUse");var b=a.offset(0,0)["in"](a.sourceAlpha).gaussianBlur("1");a.blend(a.source,b)});CWDraw.itemToDel=b;a.target&&(f||CWDraw.showDeleteBtn(a),CWDraw.delBtnTimer&&clearTimeout(CWDraw.delBtnTimer),CWDraw.delBtnLeaveTimer&&clearTimeout(CWDraw.delBtnLeaveTimer),
CWDraw.delBtnTimer=null,CWDraw.delBtnLeaveTimer=null)}};c.prototype.deleteAnn=function(a){try{CWCommentManager.deleteShape(a)}catch(b){CWPDFReader.checkReaderMode("library")?PDFRaven.captureException(b.stack):CwZ(document).trigger("cwExcToSentry",b)}};c.prototype.showDeleteBtn=function(a){if(CWDraw.drawMode===CWDrawMode.Drag||CWDraw.drawMode===CWDrawMode.Eraser||CWDraw.mouseEnabled||this.delBtnHover)CWDraw.backOnShape=!0;else{CWDraw.delBtn=CwZ(".cw-delete-btn");var b=CwZ(".cw-delete-btn");"none"!==
CwZ("#cw-pdfReaderFullScreen").css("display")?(b.css("left",a.pageX-50+"px"),b.css("top",a.pageY-50+"px")):(b.css("left",a.pageX+"px"),b.css("top",a.pageY+"px"));b.find("a").hide();b.find("a.cw-shape-delete").css("display","block");b.show()}};c.prototype.deleteBtnFuncs=function(a){function b(a){if(CWPDFReader.textHighLightOn)CWPDFReader.textHighLightOn=!1;else{a.stopImmediatePropagation();var b=CWDraw.itemToDel.node.id;a=CWAnnotate.hashSVG[b];if("undefined"===typeof a){for(var c=CwZ("#"+b),b=CwZ("#"+
b).children(),d=0;d<b.length;d++){var k=CWAnnotate.hashSVG[b[d].id];"undefined"!==typeof k&&(CWCommentManager.commentSideBar.removeComment(k),CWCommentManager.deletedArr.push(k))}c.remove()}CwZ(CWDraw.delBtn).off("click");CWDraw.deleteAnn(a);CWDraw.itemToDel.remove();CwZ(".cw-delete-btn").hide()}}CwZ(CWDraw.activeCanvas).closest(".cw-page").data("page");CwZ(CWDraw.delBtn).off("mouseenter").on("mouseenter",function(a){CWDraw.delBtnHover=!0;CWDraw.shapeMouseEnter(a,CWDraw.itemToDel,!0);CwZ(CWDraw.delBtn).off("mousedown").on("mousedown",
function(a){a.stopImmediatePropagation();b(a)})});CwZ(CWDraw.delBtn).off("mouseleave").on("mouseleave",function(){CWDraw.delBtnHover=!1;CWDraw.delBtnLeaveTimer||(CWDraw.delBtnLeaveTimer=setTimeout(function(){CWDraw.delBtnLeaveTimer=null;if(!CWDraw.backOnShape){var c=CWAnnotate.hashSVG[CWDraw.itemToDel.node.id];CWDraw.drawMode===CWDrawMode.Comment&&-1!==CWDraw.itemToDel.node.id.indexOf("Path")&&CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-comment");CWCommentManager.commentSideBar.setHoverOnLiById(c,
!1);a.unfilter();CwZ(".cw-delete-btn").hide();CwZ(CWDraw.delBtn).off("click",b)}},CWDraw.delBtnHideTimeout))});CWDraw.delBtnTimer||(CWDraw.delBtnTimer=setTimeout(function(){CWDraw.delBtnTimer=null;CWDraw.delBtnHover||CWDraw.backOnShape||CwZ(".cw-delete-btn").hide()},CWDraw.delBtnHideTimeout))};c.prototype.shapeMouseLeave=function(a){CWDataHolder.canvasMStates.mDown||(CWDataHolder.canvasMStates.onShape=!1);CwZ(a.target).css("cursor","");(CwZ(".cw-content").hasClass("cw-pointer-hand")||CwZ(".cw-content").hasClass("cw-pointer-hand-IE"))&&
CWDraw.drawMode!==CWDrawMode.Freehand&&CwZ("#cw-page-"+CWPageManager.currentPage).css("cursor","");CWDraw.backOnShape=!1;if(void 0===a||a instanceof MouseEvent)a=this;CWDraw.deleteBtnFuncs(a);var b=a.node.id,c=CWAnnotate.hashSVG[b];CWDraw.drawMode===CWDrawMode.Comment&&-1!==b.indexOf("Path")&&CwZ("#cw-pdfReader .cw-content").attr("class","cw-content cw-pointer-comment");CWCommentManager.commentSideBar.setHoverOnLiById(c,!1);if("g"===a.type)for(b=a.children(),c=0;c<b.length;c++)a=b[c],a.unfilter();
else a.unfilter()};c.prototype.deleteShapeByID=function(a){if(a=CWAnnotate.hashComment[a]){var b=void 0,b=CwZ("#"+a);b.remove()}};c.prototype.updateShapeComment=function(a,b,c){var h;if(h=c){h=!1;var e=CWCommentManager.oldComments;if(e&&e.decodedObj)for(var e=CWCommentManager.oldComments.decodedObj.comments,d=0;d<e.length;d++){var k=e[d];if(k.ID===c.ID){var g=void 0,l=void 0;if(k.points)for(g=k.points,l=c.points,k=0;k<g.length;k++){var m=g[k];if(l.x!==m.x||l.y!==m.y){h=!0;break}}else if(k.point&&
(g=k.point,l=c.point,l.x!==g.x||l.y!==g.y)){h=!0;break}}}}h?(CWCommentManager.deleteShape(c.ID,!0,!0),a=CWAnnotate.hashComment[c.ID],delete CWAnnotate.hashComment[c.ID],delete CWAnnotate.hashSVG[a],CWCommentManager.commentSideBar.addComment(c,!1)):(a=CWAnnotate.hashComment[a],c=null,a&&(c=CwZ("#"+a)).length&&c.find("title").html(b))};c.prototype.hoverSVGComment=function(a,b,c){void 0===c&&(c=!1);void 0===CWDraw.draw&&(CWDraw.draw=CWAnnotate.pagesSVG[b]);a=CWAnnotate.hashComment[a];b=null;a&&(b=CwZ("#"+
a)).length&&(a=b[0].instance,c?CWDraw.shapeMouseLeave(a):CWDraw.shapeMouseEnter(a))};c.prototype.getWidthHeight=function(a,b){return new CWPoint(2*(a.x>b.x?a.x-b.x:b.x-a.x),2*(a.y>b.y?a.y-b.y:b.y-a.y))};c.prototype.getXY=function(a,b){return new CWPoint(2*(a.x<b.x?a.x:b.x),2*(a.y<b.y?a.y:b.y))};c.prototype.drawSelection=function(){for(var a=window.getSelection(),b=CwZ("#cw-pdfDocument").width(),c=CWDataHolder.selectedTextRange.getClientRects(),h=CwZ(CWDataHolder.selectedTextRange.startContainer).closest(".cw-page"),
e=h.attr("data-page"),d=0,k=0,d=20*CWPageManager.scale/100,g=0;g<e-1;g++)d+=CWPageManager.getPageByIdx(g).pHeight*(CWPageManager.getActualZoom()/2),d+=20*CWPageManager.scale/100;d=0-d;g=20*CWPageManager.scale/100;g+=CWPageManager.getPageByIdx(e-1).pWidth*(CWPageManager.getActualZoom()/2);k=g<b?parseFloat(h.css("marginLeft"))*CWPageManager.getScale()*-1:0;"none"===CwZ("#cw-pdfReaderRestore").css("display")?(k-=50,d=d-35-40*(CWPageManager.currentPage-1)):(CwZ(".cw-body").hasClass("showSidebar")&&(k-=
200),0!==CWPageManager.scrollPosition.x&&(k+=CWPageManager.scrollPosition.x),d+=21,d-=10*(e-1));try{if(-1<navigator.userAgent.search("Firefox"))var l=CwZ("#cw-page-"+e).eq(0).position().left,k=k-l}catch(m){CWUtils.log(m)}b=[];if(0<c.length){h={left:c[0].left,top:c[0].top,right:c[0].right,bottom:c[0].bottom};for(g=1;g<c.length;g++)e={left:c[g].left,top:c[g].top,right:c[g].right,bottom:c[g].bottom},CWUtils.Compare(e.top,h.top)&&CWUtils.Compare(e.bottom,h.bottom)||e.top>h.top&&e.bottom<h.bottom?(e.left<
h.left&&(h.left=e.left),e.right>h.right&&(h.right=e.right),e.top>h.top&&e.bottom<h.bottom&&(h.top=e.top,h.bottom=e.bottom),g===c.length-1&&h.left<=e.left&&h.right>e.right&&(h.right=e.right)):(b.push(h),h=e);b.push(h)}c=[];for(g=0;g<b.length;g++)h=b[g],e=CWPageManager.getScale(),l=CWPageManager.getActualZoom()/2,c.push({x:(h.left*e+k)/l,y:(h.top*e+d-55+(window.scrollY||window.pageYOffset))/l,w:(h.right-h.left)*e/l,h:(h.bottom-h.top)*e/l});d=CWDrawFactory.getInstance();d.ID=CWAnnotate.generateID(d,
CWDraw.selectionPage);d.rects=c;d.page=CWDraw.selectionPage;d.color=CWDraw.colorHL;0<c.length&&d.points.push(c[0]);CWDraw.drawShape(d);CWCommentManager.addComment(d);CWDataHolder.currentComment=d;g=CWDraw.activeSVG.node.parentNode.id;CWAnnotate.hashSVG[g]=d.ID;CWAnnotate.hashComment[d.ID]=g;CWDraw.activeSVG=null;a.removeAllRanges()};return c}(),CWDraw=new CWDrawClass,CWDrawFactory={getInstance:function(){var c;switch(CWDraw.drawMode){case CWDrawMode.Arrow:c=new CWArrow;break;case CWDrawMode.Comment:c=
new CWComment;break;case CWDrawMode.Ellipse:c=new CWEllipse;break;case CWDrawMode.Freehand:c=new CWFreehand;break;case CWDrawMode.Highlight:c=new CWHighlight;break;case CWDrawMode.Line:c=new CWLine;break;case CWDrawMode.Rectangle:c=new CWRectangle;break;case CWDrawMode.TextSelection:c=new CWSelectionHL}c.ts=(new Date).getTime();return c}};
