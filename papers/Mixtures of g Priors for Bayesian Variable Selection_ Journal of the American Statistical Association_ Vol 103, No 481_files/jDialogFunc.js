var shareDialog={isInitialized:!1,sendToList:{},selectedPublication:null,pubId:null,cmnts:!1,sharedUsersList:[],emailRegex:/(?:[a-z0-9!#CwZ%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#CwZ%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/gi,addItem:function(e,a,t){function i(){$(".dialogShareRecipient").val("").trigger("focus"),shareDialog.hideUsers()}if(void 0===t&&(t=!0),null==e&&(e=""),e=XmL.escapeXml(e),-1==a&&(a=e.toLowerCase()),a==CWDataCenter.userEmail){var s={msg:"Sharing on your own email is not allowed, please enter valid email address.",onOk:function(){i()}};CWPDFReaderDialog.show(s)}else if(void 0===shareDialog.sendToList[a]){var n=CwZ(".shareToUsers dt li").clone(!0).insertBefore("dt.hidden").removeClass("last").find(".name").text(e).attr("data-id",a);t&&n.end().find(".allowed-rights").val(t),CwZ(".shareToUsers").show(),shareDialog.sendToList[a]=e}setTimeout(function(){i()},1)},initDialog:function(){var e=CwZ(".dialogShareRecipient");shareDialog.isInitialized=!0,e.autocomplete({appendTo:"#dialogCurtain",source:function(e,a){var t=e.term.toLocaleLowerCase();UaC.getAutocompleteRecords({query:t,et:["101","161"],onComplete:a,length:5,sender:"shareDialog"})},minLength:1,autoFocus:!0,select:function(e,a){var t="101"==a.item.type?a.item.userId:"161"==a.item.type?a.item.key:"";shareDialog.addItem(a.item.value,t)}}).data("ui-autocomplete")._renderItem=shareDialog.onRender,CwZ("#shareFile").off("click").on("click",function(){var e=CwZ(".dialogShareRecipient");e.trigger("focus")}),e.off("keydown").on("keydown",shareDialog.onautofillekeyup),e.off("paste").on("paste",shareDialog.onPaste)},onRender:function(e,a){try{var t,i="";switch(a.type){case"101":"userImg",i=a.userId;break;case"161":"groupImg",i=a.key}a.img=UaC.imageUrl("t",a.type,a.key),t="<li title='Share Publication'><a><span id='"+i+"'>"+XmL.escapeXml(a.title)+"</span></a></li>";var s=CwZ(t).data("item.autocomplete",a);return s.appendTo(e)}catch(e){}},onautofillekeyup:function(e){var a=e.keyCode,t=CwZ(this),i=UaC.trim(t.val()),s=i.length;if(8==a&&0==s)t.parent().find(".name a").last().trigger("click");else if((13==a||188==a||59==a||186==a||32==a)&&cwValidate.isEmail(i))return shareDialog.addItem(i,-1),!1},onPaste:function(){var i=CwZ(this);setTimeout(function(){var e=i.val(),a=shareDialog.parseMultipleEmails(e);if(a)for(var t=0;t<a.length;t++)cwValidate.isEmail(a[t])&&shareDialog.addItem(a[t],-1)},100)},parseMultipleEmails:function(e){return e.match(shareDialog.emailRegex)},resetDialog:function(){shareDialog.sendToList={},CwZ(".dialogShareRecipient").val(""),CwZ(".users>li").remove(),CwZ("#sendToList").html(""),shareDialog.hideUsers()},remove:function(e,a){e.remove(),delete shareDialog.sendToList[a],shareDialog.hideUsers()},showDialog:function(e,a){if(shareDialog.resetDialog(),0==CwZ("#dialogCurtain").length){$(e||"body").append('<div id="dialogCurtain" class="validateDlg" style="display:none;z-index: 9999;">&#160;</div>')}jDialog.open("shareFile",{title:"Share File",isAjax:!0,isOldStyle:!0,showPub:!!a,onLoad:shareDialog.initDialog,onShow:shareDialog.dialogOnShow,onOk:shareDialog.sendFile,onCancel:shareDialog.hideJDialog,okLabel:"Share File"}),CWUtils.updateScrollbar(".shareToUsers ul.users")},hideJDialog:function(){var e=jDialog.getActiveObject();null!=e&&e.hide()},sendFile:function(){var a="",e=$("#shareTo").val();for(var t in 0<e.length&&cwValidate.isEmail(e)&&shareDialog.addItem(e,-1),shareDialog.sendToList){var i=$('span.name[data-id="'+t+'"]').parent().find(".allowed-rights").val()||"0";a+=t+":"+i+","}function s(e){shareDialog.cmnts=e,shareDialog.shareFile(a)}a=a.substring(0,a.length-1),0!=a.length?CWCommentManager.annotationArr.length?shareDialog.statusDlg({msg:"File that you are trying to share contains annotations. Would you like to share those annotations as well?",okBtnTxt:"Yes",cnclBtnTxt:"No",onOk:function(){s(!0)},onCancel:function(){s(!1)}}):s(!1):shareDialog.statusDlg({msg:"Please add at least one recipient."})},showFooterBtn:function(){CwZ(".dialogFooter .cBtnn").removeClass("hidden"),CwZ(".dialogFooter .sendingDlg").addClass("hidden")},shareFile:function(s){function n(){shareDialog.statusDlg({msg:"Something went wrong, Please try again."}),shareDialog.hideJDialog(),shareDialog.showFooterBtn()}if(CwZ(".dialogFooter .cBtnn").addClass("hidden"),CwZ(".dialogFooter .sendingDlg").removeClass("hidden"),void 0!==s&&null!=CWDataCenter.fileId){PbX.post({objectState:"1",id:"-1",type:"120",title:" ",details:'{"Colwiz":{"description":"","Folders":""}}'},"",function(e){var a=JSON.parse(e.responseText);if(a.success){var i=a.success.id,t={id:i,objectState:"22",eusers:s,eusettings:{by:CWPDFReaderConfig.uName,msg:"File has been shared with you"},cmts:shareDialog.cmnts,svc:"cl"};PbX.post(t,"",function(e){var a=JSON.parse(e.responseText);if(a.success){var t={id:i,objectState:50,refId:CWDataCenter.fileId};PbX.post(t,"",function(e){var a=JSON.parse(e.responseText);a.success?(shareDialog.statusDlg({msg:"File shared successfully."}),shareDialog.getSharedUsers(i)):n(),shareDialog.hideJDialog(),shareDialog.showFooterBtn()},n)}else n()},n)}else n()},n)}},getSharedUsers:function(e){PaX.get("/app?x=44e&et=120&rsvp=1&refId="+e+"&svc=cl","",!0,function(e){var a=$($.parseXML(e.responseText)),t=a.find("Colwiz Euser"),n={4:"0",C:"1"};t.each(function(){var e=$(this),a="1C"==e.attr("roles");if(!a){var t=e.attr("title")||e.attr("email"),i=e.attr("uId"),s=n[e.attr("roles")];shareDialog.addItem(t,i,s)}})})},hideUsers:function(){0==CwZ("ul.users>li").length?CwZ("ul.users").addClass("hidden"):(CwZ("ul.users").removeClass("hidden"),CwZ("ul.users").css("display","inline-block"))},statusDlg:function(e){var a={okBtnTxt:"OK",dontHide:!1,title:"",msg:"Something went wrong please reload.",onOk:function(){}};$.extend(a,e),CWPDFReaderDialog.show(a)},dialogOnShow:function(){shareDialog.resetDialog(),CwZ(".cw-btn.removercpt").off("click").on("click",function(e){var a=$(e.currentTarget).parents("li"),t=a.find("span.name").data("id");shareDialog.remove(a,t)}),null!=shareDialog.selectedPublication?(shareDialog.pubId=shareDialog.selectedPublication.find("a:eq(0)").attr("href").replace(/^(.*&eId=)(.*)CwZ/,"CwZ2"),shareDialog.pubId&&(shareDialog.pubId=shareDialog.pubId.split("&")[0]),CwZ(".publicationsContent ul li").html("").append(shareDialog.selectedPublication)):CwZ(".publicationsContent").parents("tr:eq(0)").hide(),CwZ("#quickRecomend input").trigger("focus")}},XmL={escapeXml:function(e){return null==e?"":(e=XmL.unescapeXml(e.toString()),e.replace(/^\s+/,"").replace(/\s+CwZ/,"").replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/\'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))},unescapeXml:function(e){return e.toString().replace(/^\s+/,"").replace(/\s+CwZ/,"").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")}},cwValidate={isEmail:function(e){return/^([a-zA-Z0-9_\-\.\+]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(UaC.trim(e))}},UaC={updateTimer:{},records:{},etArray:{},recordsLoaded:!1,recordsParsed:!1,updateTime:3e5,isInit:!1,init:function(){UaC.isInit||(UaC.isInit=!0,UaC.resetAutocompleteRecord())},imageUrl:function(e,a,t){return"/images/data/"+e+"/"+a+"/"+t+".jpg?"+Date.now()},resetAutocompleteRecord:function(){for(var e in UaC.updateTimer)clearInterval(UaC.updateTimer[e]),UaC.updateTimer[e]=-1;UaC.records={},UaC.updateTimer={}},emptyFunction:function(){},ajaxCompleteCallback:function(e,a){var t=e.status;0!=t&&200<=t&&t<300&&a(e)},updateAutocompleteRecords:function(e){var a=e.et,t={};if(UaC.recordsLoaded){if(!UaC.recordsParsed)for(var i=UaC.etArray.proId,s=0;s<a.length;s++){var n=a[s];UaC.records[n]=[],t=CwZ.parseJSON(UaC.etArray[n]||'{"List":"[]"}');var r=t.List.Item,o=r?r.length:0;if(0<o)for(var l=0;l<o;l++)if(r[l].id!=i){var c={key:r[l].id,title:r[l].title,value:r[l].title,userId:r[l].uId,streamId:r[l].streamId,roles:r[l].roles,flags:parseInt(r[l].flags).toString(2),type:n};40<c.value.length&&(c.value=UaC.truncate(c.value,40)),UaC.records[n].push(c)}s<a.length-1&&(UaC.records[a[s+1]]=[]),l==o&&(UaC.recordsParsed=!0)}e.onComplete(UaC.filterRecords(e))}},truncate:function(e,a){return e.substr(0,a)+(e.length>a?"...":"")},trim:function(e){try{var a="";e&&null!=e&&0<e.length&&(a=e),a=a.replace(/^[\xA0\s]+/,"").replace(/[\xA0\s]+CwZ/,"")}catch(e){}return a},filterRecords:function(e){var a=[];e.et instanceof Array?a=e.et:a.push(e.et);for(var t=[],i=e.query,s=0,n=a.length;s<n;s++){var r=a[s],o=UaC.records[r],l=o.length,c=-1==e.length?l:e.length,d="161"==(o[0]&&o[0].type);if(""==i)return o;if(o&&0<o.length)for(var u=0;u<l;u++)if(d){if(6!=o[u].flags.length)for(;0<6-o[u].flags.length;)o[u].flags=0+o[u].flags;if(("12"==o[u].roles||"28"==o[u].roles)&&0!=o[u].flags[1]){var g=o[u].title.toLocaleLowerCase();if(-1==g.indexOf(i))continue;if(t.length>=c)break;t.push(o[u])}}else{g=o[u].title.toLocaleLowerCase();if(-1==g.indexOf(i))continue;if(t.length>=c)break;t.push(o[u])}}return t},getAutocompleteRecords:function(e){var a={length:10,query:"",et:"101",onComplete:function(){}};CwZ.extend(a,e),a.et instanceof Array||(a.et=[a.et]),UaC.updateAutocompleteRecords(a)}},PbX={noCache:0,ajax:function(a){null==a.type&&(a.type="get"),null==a.success&&(a.success=UaC.emptyFunction),null==a.error&&(a.error=UaC.emptyFunction),null==a.params&&(a.params="");var e=a.url;e.indexOf("://")<0&&(e=CWPDFReaderConfig.cwURL+(e.indexOf("app?")<0?"/app?x=":"/")+e),null==a.async&&(a.async=!0);var t=a.params,i="y="+CWPDFReaderConfig.uId;return t=null==t||null==t||t.length<1?i:t+"&"+i,void 0!==a.params&&"string"==typeof a.params&&"get"==a.type.toLowerCase()?a.params+="&load="+PaX.nocache:a.params.load=PaX.nocache,CwZ.ajax({url:e,type:a.type,data:a.params,async:a.async,complete:function(e){UaC.ajaxCompleteCallback(e,a.success)},error:a.error})},post:function(e,a,i,t){t=t||PbX.failHandler;var s={xTask:a};s=this.get("token",CWDataCenter.token,s),s=this.get("uId",CWPDFReaderConfig.uId,s),s=this.get("id",e.id,s),s=this.get("os",e.objectState,s),s=this.get("ty",e.type,s),s=this.get("ti",e.title,s),s=this.get("rf",e.refId,s),s=this.get("fg",e.flags,s),s=this.get("eu",e.eusers,s),s=this.get("euid",e.euId,s),s=this.get("eus",e.eusettings,s),s=this.get("mts",e.mts,s),s=this.get("sts",e.sts,s),s=this.get("ets",e.ets,s),s=this.get("st",e.settings,s),s=this.get("dt",e.details,s),s=this.get("rank",e.rank,s),s=this.get("pts",e.pts,s),s=this.get("cmts",e.cmts,s),null==i&&(i=function(){}),PaX.post(CWPDFReaderConfig.cwURL+"/pbx",function(e,a,t){i(t)},t,s)},failHandler:function(e){200!=e.status&&shareDialog.statusDlg({msg:"You're not signed in. Please try again later."}),CwZ(".lnk").removeClass("postDisable")},get:function(e,a,t){return null!=a&&(t[e]=a),t}},PaX={nocache:0,post:function(e,a,t,i){return a||(a=function(){}),t||(t=function(){}),i||(i=[]),PaX.nocache++,CwZ.ajax({type:"POST",dataType:"text",url:e,data:i,success:a,error:t})},get:function(e,a,t,i,s){if(CWDataCenter.isLogin){var n="y="+CWPDFReaderConfig.uId;return a=null==a||null==a||a.length<1?n:a+"&"+n,null==i&&(i=UaC.emptyFunction),null==s&&(s=UaC.emptyFunction),e.indexOf("://")<0&&(e=CWPDFReaderConfig.cwURL+(e.indexOf("app?")<0?"/app?x=":"/")+e),null==t&&(t=!0),void 0!==a&&"string"==typeof a?a+="&load="+PaX.nocache:a.load=PaX.nocache,CwZ.ajax({url:e,type:"get",data:a,async:t,complete:function(e){UaC.ajaxCompleteCallback(e,i)},error:s})}}},WiZ={disableWindowScroll:function(e,a){var t=void 0!==a?a:"body";e?CwZ(t).on("mousewheel",function(){return!1}):CwZ(t).off("mousewheel")}};